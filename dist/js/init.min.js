/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
function error(t){output("error",t,!0)}function warn(t){output("warn",t,!0)}function info(t){output("info",t,settings.log)}function debug(t){output("log",t,settings.debug)}function output(t,e,i){!0===i&&"object"==typeof window.console&&console[t]("DentifriceEditor: "+e)}function loadSettings(t){var e={log:!0,debug:!1,showSpinner:!0,noinlineAttr:'inline="false"',uploadURL:"http://localhost:8080/files",plugins:{draftStore:"drafts-localstore.js",uploadStore:"upload-simplestore.js",beforeEditor:[],afterEditor:[]}};settings=_.merge(e,t),CKEDITOR_BASEPATH=settings.appRootUrl+"/ckeditor/"}function _init(t){t.appRootUrl=appRootUrl,t.lang=lang,t.title=title,loadSettings(t),dtfInit.loadEditor()}function _getQueryParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}var msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,title,lang,appRootUrl,postMessage_module=function(){var t={type:"",content:""},e=function(t){t.data},i=function(e,i){var n;t.type=e,t.content=i,n=JSON.stringify(t),a(n)},a=function(t){parent.postMessage(msgPrefix+t,"*")},n=window.addEventListener?"addEventListener":"attachEvent",o=window[n],s="attachEvent"==n?"onmessage":"message";return o(s,e,!1),{createMessageToSend:i,messageObj:t,get:e,post:a}}(),blocksIcons={title:'<i class="icon-text">T</i>',paragraph:'<i class="fa fa-2x fa-align-justify"></i>',image:'<i class="fa fa-2x fa-picture-o"></i>',"1col_image_top":'<i class="fa fa-2x fa-picture-o"></i><br /><i class="fa fa-2x fa fa-align-justify"></i>',"2cols_image_top":'<i class="fa fa-2x fa-picture-o"></i><i class="fa fa-2x fa-picture-o"></i><br /><i class="fa fa-2x fa fa-align-justify"></i><i class="fa fa-2x fa fa-align-justify"></i>',"2cols_image_bottom":'<i class="fa fa-2x fa fa-align-justify"></i><i class="fa fa-2x fa fa-align-justify"></i><br /><i class="fa fa-2x fa-picture-o"></i><i class="fa fa-2x fa-picture-o"></i>',quote:'<i class="icon-text icon-quote">&rdquo;</i>',mixed_image_left:'<i class="fa fa-2x fa-picture-o"></i><i class="fa fa-2x fa-align-justify"></i>',mixed_image_right:'<i class="fa fa-2x fa-align-justify"></i><i class="fa fa-2x fa-picture-o"></i>',mixed_image_top:'<i class="fa fa-2x fa-picture-o"></i><br /><i class="fa fa-2x fa-align-justify"></i>',mixed_image_bottom:'<i class="fa fa-2x fa-align-justify"></i><br /><i class="fa fa-2x fa-picture-o"></i>'},settings={},CKEDITOR_BASEPATH,getAbsoluteUrl=function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");return e.test(t)?t:settings.appRootUrl+t.replace(/^\//,"")},spinner=function(t){var e=$(".overlay"),i=$(".spinner"),a=window.innerWidth/2-i.width()/2;if(i.css("left",a),settings.showSpinner)switch(t){case"show":debug("Showing spinner"),e.show(),i.show();break;case"hide":debug("Hiding spinner"),i.hide(),e.hide();break;default:warn("Unknown spinner action")}},blocks_config={styles:{}},dtfInit=function(t){"use strict";var e=function(i,a,n,o){"string"==typeof i&&(i=[i]),debug("Loading script: "+i[a]),t.getScript(i[a],function(){a+1<=i.length-1?e(i,a+1,n,o):n&&n()}).fail(function(t,e,n){warn(i[a]+" loading error: "+n),o&&o()})},i=function(){spinner("show");var i=[settings.appRootUrl+"js/plugins/"+settings.plugins.draftStore,settings.appRootUrl+"js/plugins/"+settings.plugins.uploadStore];"string"==typeof settings.plugins.beforeEditor&&(settings.plugins.beforeEditor=[settings.plugins.beforeEditor]);var a=settings.plugins.beforeEditor.map(function(t){return getAbsoluteUrl(t)});i=i.concat(a),i.push(settings.appRootUrl+"js/editor.js"),"string"==typeof settings.plugins.afterEditor&&(settings.plugins.afterEditor=[settings.plugins.afterEditor]);var n=settings.plugins.afterEditor.map(function(t){return getAbsoluteUrl(t)});i=i.concat(n),e(i,0,function(){info("Initializing locale"),t.i18n.init({lng:settings.lang,fallbackLng:"en",lowerCaseLng:!0,resGetPath:settings.appRootUrl+"locales/__lng__.json",useLocalStorage:!1,debug:settings.debug},function(){info("Initializing editor"),dtfEditor.load(),spinner("hide")})})};return{loadScripts:e,loadEditor:i}}(jQuery);!function(t){var e=location.href;appRootUrl=e.substring(0,e.lastIndexOf("/")+1);var i=appRootUrl+"_local_settings.js",a=_getQueryParameterByName("template"),n=_getQueryParameterByName("styles"),o=_getQueryParameterByName("config");lang=_getQueryParameterByName("lang"),title=_getQueryParameterByName("title"),t("#dtf-content").load(a,function(e,a,s){"error"==a?error("Could not load template URL "+templateURL+": "+s.status+" "+s.statusText):(debug("Template loaded"),t.get(n,function(e){var a=t("<tmp/>").html(e);a.find("style").attr("data-userstyle",!0),a.contents().appendTo("head"),debug("Styles loaded"),t.getJSON(o,function(t){debug("Configuration loaded"),blocks_config=t,dtfInit.loadScripts(i,0,function(){_init(local_settings)},function(){var t={};_init(t)})}).fail(function(){error("Could not load configuration URL:"+configURL)})}).fail(function(){error("Could not load styles URL:"+stylesURL)}))})}(jQuery);
//# sourceMappingURL=init.min.js.map
