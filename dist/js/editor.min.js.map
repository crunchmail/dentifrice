{"version":3,"sources":["content-mode.js","layout-mode.js","drafts-manager.js","uploadify.js","editor.js"],"names":["dtfContentMode","$","attrHref","enter","info","each","dtfEditor","blocksCatalog","configs","name","config","selector","addClass","undefined","urlckEditor","confCkeditor","JSON","parse","localStorage","getItem","find","attr","ckeditor","addBack","filter","uploadify","closest","length","parent","removeAttr","makeResizable","is","show","contentLinks","debug","this","href","on","event","preventDefault","leave","CKEDITOR","instances","_","instance","destroy","removeClass","resizable","remove","unwrap","data","jQuery","dtfLayoutMode","_draggable","block","parent_div","sortable","items","placeholder","revert","scrollSpeed","sort","ui","centerElement","height","item","topElement","offset","top","windowPos","parseFloat","window","scrollTop","start","css","scrollTo","stop","hasClass","changeClass","equipBlock","_addDelBtn","prev","templates","blockDelButton","insertBefore","element","next","row","before_row","row_parent","removed","deleteBlock","hide","pushToStack","after","prepend","flashUndo","_hide_catalog","_show_catalog","html","get_gallery","numberOfElement","i","draft_row","blockAddBar","fadeIn","blockClass","draft_rowAdd","blockChange","classesElement","removeOldClasse","split","join","arrClass","append","nameClass","deleted","add","clone","dtfDraftsManager","saveDraft","document","getElementById","spinner","resultPrompt","prompt","t","save","draftStore","draftExists","confirm","date","Date","toLocaleDateString","toLocaleTimeString","getContent","styles","getUserStyles","blocks_config","setMessage","hideMenu","console","log","listDrafts","draftsListUl","empty","list","forEach","draft","draftLi","id","spanDate","spanName","spanDelete","e","loadDraft","err","deleteDraft","stopPropagation","deleteAllDrafts","v","parentNode","getAttribute","removeChild","fn","idx","el","img","maxWidthResizable","Math","round","naturalHeight","naturalWidth","width","configResizable","maxWidth","minWidth","aspectRatio","handles","showUploadForm","showFormButton","fileInput","browseBtn","waiter","uploadForm","hideUploadForm","startWaiting","imageUploadForm","imageUploadButton","i18n","wrap","closeLink","click","change","FormData","url","uploadStore","doUpload","dataResizable","newImg","replaceWith","setTimeout","blocks","doms","icons","title","paragraph","image","1col_image_top","2cols_image_top","2cols_image_bottom","quote","mixed_image_left","mixed_image_right","mixed_image_top","mixed_image_bottom","children","get_dom","get_divClass","divClass","block_config","dom","that","isUnique","listChangeable","blockIcon","blockCaption","icon","caption","link","first","existBlockDom","dom_block","new_row","baseBlock","undoBtn","flash","actionStack","push","_fetchBlocksConfig","forOwn","ckEditorUrl","getAbsoluteUrl","getJSON","ckEditor","language","settings","lang","setItem","stringify","_removeDataAttributes","$target","dataAttrsToDelete","dataAttrs","get","attributes","dataAttrsLen","substring","index","attrName","_generateFinal","error","boilerplateURL","appRootUrl","boilerplate","replace","noinlineAttr","postMessage","msgPrefix","_lockEdition","fail","warn","$head","unescape","String","prototype","htmlEncode","charsToReplace","“","”","char","cleanup","$content","match","before","stack","func","undo","last_el","pop","UndoButton","btn","flash_color","orig_color","animate","backgroundColor","lock","fadeOut","_loadToolbar","toolbar","layoutToolbar","layoutModeBtn","proxy","contentModeBtn","validateBtn","resumeBtn","containerListDraft","saveDraftBtn","draftsListBtn","closeDraftsListBtn","text","status","temp","layoutMessages","delay","load"],"mappings":"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","file":"editor.min.js","sourcesContent":["// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfContentMode = (function( $ ) {\n  'use strict';\n\n  var attrHref;\n\n  var enter = function() {\n    info('Entering ContentMode');\n\n    $.each(dtfEditor.blocksCatalog.configs, function(name, config) {\n      // Add CKEditor instances\n      $(config.selector).addClass('dtf-block');\n      if(config.urlckEditor !== undefined) {\n        //get localStorage json file\n        var confCkeditor = JSON.parse(localStorage.getItem(config.selector));\n        $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor(confCkeditor);\n      }\n      else {\n        $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor();\n      }\n\n      // Add controls around uploadable images\n      $(config.selector).find('*').addBack()\n        .filter('.dtf-imageUploadable')\n        .uploadify();\n\n      if($(config.selector).find('.dtf-imageUploadable').closest('a').length > 0) {\n\n        attrHref = $(config.selector).find('.dtf-imageUploadable').parent('a').attr('href');\n        $(config.selector)\n          .find('.dtf-imageUploadable').parent('a')\n          .removeAttr('href')\n          .attr('data-href', attrHref);\n      }\n\n      // Add controls for resizable images\n      $(config.selector).find('*').addBack()\n        .filter('.dtf-resizable')\n        .makeResizable();\n\n      if($('.ui-resizable-handle').is(':hidden')) {\n        $('.ui-resizable-handle').show();\n      }\n\n      // Disable click on all links outside content editables\n      var contentLinks = $('#dtf-content a:not(.cke_editable a)');\n      contentLinks.each(function () {\n        debug('Disabling clicks on link: ' + this.href);\n      });\n      contentLinks.on('click', function(event) {\n        event.preventDefault();\n      });\n    });\n  };\n\n  var leave = function() {\n    info('Leaving ContentMode');\n    // Remove content-editables\n    $.each(CKEDITOR.instances, function (_, instance) {\n      instance.destroy();\n    });\n    $('.dtf-contentEditable').attr('contentEditable', false);\n    $('.sortable-element').removeClass('sortable-element');\n\n    // Remove controls for resizable images\n    $('.dtf-resizable').resizable(\"destroy\");\n    // Remove controls uploadable image\n    $('.dtf-image-wrap').find(':not(.dtf-imageUploadable)').remove();\n    $('img.dtf-imageUploadable').unwrap();\n\n    if($('.dtf-imageUploadable').closest('a').length > 0) {\n      attrHref = $('.dtf-imageUploadable').parent('a').data('href');\n\n      $('.dtf-imageUploadable').parent('a')\n        .removeAttr('data-href')\n        .attr('href', attrHref);\n    }\n  };\n\n  return {\n    enter : enter,\n    leave : leave,\n  };\n\n})( jQuery );\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfLayoutMode = (function( $ ) {\n  'use strict';\n\n  var _draggable = function(block) {\n    var parent_div = block.closest('div'),\n      c = {};\n\n    parent_div.addClass('sortable-element');\n\n    $('#templateContainer').sortable({\n      items: '.sortable-element',\n      placeholder: \"ui-state-highlight\",\n      revert: true,\n      scrollSpeed: 40,\n      sort: function(event, ui) {\n        var containerHeight = $('#templateContainer').height()/2;\n        var centerElement = (ui.item.height()/2)/2;\n        var topElement = ui.item.offset().top/2;\n        var windowPos = parseFloat(topElement) + parseFloat(centerElement);\n        $(window).scrollTop(windowPos);\n      },\n      start: function(event, ui) {\n        ui.placeholder.height(ui.item.height());\n        $('.dtf-tr-element').remove();\n        $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 0.5);\n        var centerElement = (ui.item.height()/2);\n        var topElement = ui.item.offset().top;\n        var windowPos = parseFloat(topElement) + parseFloat(centerElement) - 100;\n        window.scrollTo(0, windowPos);\n      },\n      stop: function(event, ui) {\n        $('.button-del').remove();\n        $('.dtf-block').each(function() {\n          if($(this).hasClass('dtf-changeable')) {\n            changeClass($(this));\n          }else {\n            equipBlock($(this));\n          }\n        });\n        $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 1);\n      }\n    });\n  };\n\n  var _addDelBtn = function(block) {\n    if (block.prev('.pure-button-del').length <= 0 && !block.hasClass('isUnique')) {\n      $(window.templates.blockDelButton)\n        .insertBefore(block)\n        .on('click', function(){\n          var element = $(this).next();\n          var row = element.closest('tr');\n          var before_row = row.prev();\n          var row_parent = row.parent();\n          var next_draft = row.next('tr');\n          var removed = deleteBlock(element).hide();\n          dtfEditor.pushToStack(function(){\n            // Record previous element or parent if first\n            if (before_row.length > 0) {\n              before_row.after(removed);\n            } else {\n              row_parent.prepend(removed);\n            }\n            removed.show(200);\n          });\n          dtfEditor.flashUndo();\n        });\n    }\n  };\n\n  var _hide_catalog = function() {\n    $('.dtf-catalog').hide(100);\n    $('.dtf-add-bar .button-add:hidden').show(100);\n  };\n\n  var _show_catalog = function() {\n    _hide_catalog();\n    $(this).hide(100);\n\n    // show my catalog\n    $(this).closest('div').find('.dtf-catalog')\n      .html(dtfEditor.blocksCatalog.get_gallery())\n      .show(100);\n  };\n\n  var enter = function() {\n    info('Entering LayoutMode');\n\n    var numberOfElement = $('.dtf-block').length;\n    $('.dtf-block').each(function(i) {\n      //addClass lastClass to last element\n      if(i === numberOfElement - 1 ) $(this).addClass('lastChild');\n      if(!$(this).hasClass('dtf-changeable')) {\n        equipBlock($(this));\n        _draggable($('.dtf-draggable'));\n      }else {\n        changeClass($(this));\n      }\n    });\n\n    // Block adding\n    $('.first-hidden').show(100);\n    $(this).hide(100);\n  };\n\n  var leave = function() {\n    info('Leaving LayoutMode');\n\n    $('.dtf-draft-block').closest('div').remove();\n    $('.button-del').remove();\n    $('.first-hidden').hide(100);\n    $('#dtf-layout-mode').show(100);\n    $('.dtf-deletion-border').removeClass('dtf-deletion-border');\n    $( \"#templateContainer\" ).sortable( \"destroy\" );\n  };\n\n  /**\n   * Equips a block with a border and block inserting tool under it.\n   */\n  var equipBlock = function(block) {\n    var parent_div = block.closest('div');\n\n    block.addClass('dtf-deletion-border');\n    if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n      var draft_row = $(window.templates.blockAddBar);\n      draft_row.find('button').on('click', _show_catalog);\n      _hide_catalog();\n\n      parent_div.after(draft_row.fadeIn());\n    }\n\n    //Add button delete block if not Unique\n    _addDelBtn(block);\n\n  };\n\n  //Change Class of element with listChangeable in configuration.json\n  var changeClass = function(block, blockClass) {\n    var parent_div = block.closest('div');\n    //console.log(parent_div.find('.dtf-block'));\n\n    block.addClass('dtf-deletion-border');\n    if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n      if(!block.hasClass('lastChild')) {\n        var draft_rowAdd = $(window.templates.blockAddBar);\n\n        draft_rowAdd.find('button').on('click', _show_catalog);\n        _hide_catalog();\n\n        parent_div.after(draft_rowAdd.fadeIn());\n      }\n\n      var draft_row = $(window.templates.blockChange);\n      var classesElement = parent_div.find('.dtf-block').data('change-class');\n      var removeOldClasse = classesElement.split(',').join(' ');\n      var arrClass = classesElement.split(',');\n\n      parent_div.after(draft_row);\n\n      $.each(arrClass, function() {\n        if(block.closest('div').find('.dtf-block').hasClass(this)) {\n          draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"active dtf-background '+this+'\"></div>');\n\n        }else {\n          draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"dtf-background '+this+'\"></div>');\n        }\n\n      });\n\n      block.closest('div').next().on('click', '.dtf-background', function() {\n        $('.dtf-background').removeClass('active');\n        $(this).addClass('active');\n        draft_row.prev().find('.dtf-block').removeClass(removeOldClasse);\n        var nameClass = $(this).data('background');\n        draft_row.prev().find('.dtf-block').addClass(nameClass);\n\n      });\n    }\n\n    //Add button delete block if not Unique\n    _addDelBtn(block);\n  };\n\n  var deleteBlock = function (block) {\n    /* the setattr is a woraround to avoid getting a hidden forever\n     * cloned element\n     */\n    var parent_div = block.closest('div');\n    var deleted;\n    //console.log(parent_div.next('div'));\n    if(block.hasClass(\"dtf-changeable\")) {\n      deleted = $().add(parent_div).add(parent_div.next('div')).add(parent_div.next('div').next('div'));\n    }else {\n      deleted = $().add(parent_div).add(parent_div.next('div'));\n    }\n\n    var clone = deleted.clone(true, true);\n    deleted.hide(200, function() {\n      $(this).remove();\n    });\n    return clone;\n  };\n\n  return {\n    enter       : enter,\n    leave       : leave,\n    changeClass : changeClass,\n    equipBlock  : equipBlock,\n    deleteBlock : deleteBlock\n  };\n\n})( jQuery );\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfDraftsManager = (function( $ ) {\n  'use strict';\n\n  var versionTpl = 1;\n  var containerListDraft = document.getElementById('containerListDraft');\n\n  var saveDraft = function() {\n    spinner('show');\n    var resultPrompt = prompt($.t('drafts.name_prompt'), $.t('drafts.default_name'));\n\n    if ( resultPrompt !== \"\" && resultPrompt !== null ) {\n      var save = true;\n\n      if ( draftStore.draftExists(resultPrompt) ) {\n        info('Draft name already exist: ' + resultPrompt);\n        save = confirm($.t('drafts.overwrite_confirm'));\n        if (save === true) info('Overwriting draft named ' + resultPrompt);\n      }\n\n      if ( save === true ) {\n        var date = new Date();\n        date = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n\n        var html = dtfEditor.getContent();\n        var styles = dtfEditor.getUserStyles();\n\n        if ( draftStore.saveDraft( resultPrompt, html, styles, blocks_config, date ) ) {\n          dtfEditor.setMessage($.t('drafts.save_ok'), 'valid');\n        } else {\n          dtfEditor.setMessage($.t('drafts.save_error'), 'error');\n        }\n      }\n    } else if ( resultPrompt === \"\" ) {\n      dtfEditor.setMessage($.t('drafts.name_empty'), 'error');\n    }\n    spinner('hide');\n  };\n\n  var hideMenu = function() {\n    console.log(\"hideMenu\")\n    $('#containerListDraft').removeClass('isActive');\n  };\n\n  var listDrafts = function() {\n    var draftsListUl = $('#listDraft');\n    draftsListUl.empty();\n\n    var list = draftStore.listDrafts();\n\n    list.forEach( function(draft) {\n\n      var draftLi = $(\"<li/>\");\n      draftLi.attr('data-objId', draft.id);\n\n      var spanDate = $('<span class=\"draftDate\">'+draft.date+'</span>');\n\n      var spanName = $('<span class=\"draftName\">'+draft.name+'</span>');\n\n      var spanDelete = $('<span class=\"spanDelete fa fa-minus-circle\"/>');\n\n\n      draftLi.append(spanDate);\n      draftLi.append(spanName);\n      draftLi.append(spanDelete);\n\n      draftLi.on('click', function(e) {\n        if ( confirm($.t('drafts.restore_confirm')) ) {\n          try {\n            // Replace blocks configuration\n            draftStore.loadDraft(draft.id);\n          } catch(err) {\n            dtfEditor.setMessage($.t('drafts.restore_error'), 'error');\n          }\n        }\n      });\n\n      spanDelete.on('click', function(e) {\n        if(confirm($.t('drafts.delete_confirm'))) {\n          //var id = this.parentNode.getAttribute('data-objId');\n          if ( draftStore.deleteDraft(draft.id) ) {\n            draftLi.remove();\n            dtfEditor.setMessage($.t('drafts.delete_ok'), 'valid');\n          } else {\n            dtfEditor.setMessage($.t('drafts.delete_error'), 'error');\n          }\n        }\n        e.stopPropagation();\n      });\n\n      draftsListUl.append(draftLi);\n    });\n  };\n\n  var deleteAllDrafts = function() {\n    var list = draftStore.listDrafts();\n    var draftsListUl = document.getElementById('listDraft');\n\n    for ( var v in list ) {\n      var id = this.parentNode.getAttribute('data-objId');\n      if ( draftStore.deleteDraft(id) ) {\n        draftsListUl.removeChild(draftLi);\n      }\n    }\n  };\n\n  return {\n    saveDraft       : saveDraft,\n    listDrafts      : listDrafts,\n    hideMenu        : hideMenu,\n    deleteAllDrafts : deleteAllDrafts\n  };\n\n})( jQuery );\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\n(function ( $ ) {\n\t'use strict';\n\n\tvar instances;\n\n\t$.fn.makeResizable = function () {\n\t\t$.each(this, function(idx, el) {\n\t\t\tvar img = $(el);\n\n\t\t\tvar ratioResizable = Math.round(img[0].naturalHeight / img[0].naturalWidth);\n\t\t\tvar maxWidthResizable = img.closest('td').width();\n\t\t\tvar configResizable = {\n\t\t\t\tmaxWidth: maxWidthResizable,\n\t\t\t\tminWidth: 50,\n\t\t\t\taspectRatio: true,\n\t\t\t\thandles:\"e, s, se\"\n\t\t\t};\n\t\t\tif(img.data('resizable') === 'left') {\n\t\t\t\tconfigResizable.handles = \"sw, w, s\";\n\t\t\t}\n\t\t\timg.resizable(configResizable);\n\t\t});\n\t\treturn this;\n\t};\n\n\t$.fn.uploadify = function () {\n\t\t$.each(this, function(idx, el) {\n\t\t\tvar uploadForm = $(window.templates.imageUploadForm);\n\t\t\tvar img = $(el);\n\t\t\tvar showFormButton = $(window.templates.imageUploadButton);\n\t\t\tvar attrHref;\n\n\t\t\tuploadForm.i18n();\n\n\t\t\tif(img.closest('a').length > 0) {\n\t\t\t\tattrHref = img.parent('a').attr('href');\n\t\t\t\timg.parent('a')\n\t\t\t\t\t.removeAttr('href')\n\t\t\t\t\t.attr('data-href', attrHref);\n\t\t\t}\n\n\t\t\timg.wrap('<div class=\"dtf-image-wrap\">');\n\t\t\timg.parent().append(showFormButton);\n\t\t\timg.parent().append(uploadForm.hide());\n\t\t\tvar waiter = uploadForm.find('.dtf-waiter');\n\t\t\tvar fileInput = uploadForm.find('input');\n\t\t\tvar browseBtn = uploadForm.find('.upload-button');\n\t\t\tvar closeLink = uploadForm.find('.button-cancel');\n\n\t\t\tfunction showUploadForm() {\n\t\t\t\tshowFormButton.hide();\n\t\t\t\tfileInput.show();\n\t\t\t\tbrowseBtn.show();\n\t\t\t\twaiter.hide();\n\t\t\t\tuploadForm.show();\n\t\t\t}\n\n\t\t\tfunction hideUploadForm() {\n\t\t\t\tuploadForm.hide();\n\t\t\t\tshowFormButton.show();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfunction startWaiting() {\n\t\t\t\tfileInput.hide();\n\t\t\t\tbrowseBtn.hide();\n\t\t\t\twaiter.show();\n\t\t\t}\n\n\t\t\tshowFormButton.click(showUploadForm);\n\t\t\tcloseLink.click(hideUploadForm);\n\n\t\t\tfileInput.change(function() {\n\t\t\t\tvar data = new FormData(uploadForm[0]);\n\t\t\t\tvar url = uploadStore.doUpload(data);\n\n\t\t\t\tif ( null !== url ) {\n\t\t\t\t\tvar dataResizable = (img.data('resizable') === undefined ? 'right' : img.data('resizable'));\n\n\t\t\t\t\tif ( img.hasClass('dtf-resizable') ) {\n\t\t\t\t\t\t\timg.resizable(\"destroy\");\n\t\t\t\t\t}\n\n\t\t\t\t\tvar parent = img.parent();\n\t\t\t\t\tvar newImg = $('<img data-resizable=\"' + dataResizable + '\" class=\"dtf-resizable dtf-imageUploadable\" src=\"' + url + '\" width=\"' + img.width() + 'px\" />');\n\t\t\t\t\tparent.replaceWith(newImg);\n\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\tnewImg.uploadify();\n\t\t\t\t\t\tnewImg.makeResizable();\n\t\t\t\t\t}, 1000);\n\t\t\t\t} else {\n\t\t\t\t\tdtfEditor.setMessage($.t('upload.error'), 'error');\n\t\t\t\t}\n\n\t\t\t\thideUploadForm();\n\t\t\t\tstartWaiting();\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\t  return this;\n  };\n\n}( jQuery ));\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfEditor = (function ( $ ) {\n  'use strict';\n\n  /**\n   * Blocks Catalog\n   */\n  var blocksCatalog = {\n    // DOM catalog\n    blocks  : $('<div>'),\n    // DOM content of each block, indexed by name as per configuration.json\n    doms    : {},\n    // blocks configs dictionnary\n    configs : {},\n\n    // Block icons library\n    icons   : {\n      'title'              : '<i class=\"icon-text\">T</i>',\n      'paragraph'          : '<i class=\"fa fa-2x fa-align-justify\"></i>',\n      'image'              : '<i class=\"fa fa-2x fa-picture-o\"></i>',\n      '1col_image_top'    : '<i class=\"fa fa-2x fa-picture-o\"></i><br /><i class=\"fa fa-2x fa fa-align-justify\"></i>',\n      '2cols_image_top'    : '<i class=\"fa fa-2x fa-picture-o\"></i><i class=\"fa fa-2x fa-picture-o\"></i><br /><i class=\"fa fa-2x fa fa-align-justify\"></i><i class=\"fa fa-2x fa fa-align-justify\"></i>',\n      '2cols_image_bottom' : '<i class=\"fa fa-2x fa fa-align-justify\"></i><i class=\"fa fa-2x fa fa-align-justify\"></i><br /><i class=\"fa fa-2x fa-picture-o\"></i><i class=\"fa fa-2x fa-picture-o\"></i>',\n      'quote'              : '<i class=\"icon-text icon-quote\">&rdquo;</i>',\n      'mixed_image_left'   : '<i class=\"fa fa-2x fa-picture-o\"></i><i class=\"fa fa-2x fa-align-justify\"></i>',\n      'mixed_image_right'  : '<i class=\"fa fa-2x fa-align-justify\"></i><i class=\"fa fa-2x fa-picture-o\"></i>',\n      'mixed_image_top'    : '<i class=\"fa fa-2x fa-picture-o\"></i><br /><i class=\"fa fa-2x fa-align-justify\"></i>',\n      'mixed_image_bottom' : '<i class=\"fa fa-2x fa-align-justify\"></i><br /><i class=\"fa fa-2x fa-picture-o\"></i>'\n    },\n\n    get_gallery: function () {\n      return this.blocks.children().clone(true, true);\n    },\n\n    get_dom: function ( name ) {\n      return this.doms[name].html.clone(true, true);\n    },\n\n    get_divClass: function ( name ) {\n      return this.doms[name].divClass;\n    },\n\n    add: function ( name, block_config, dom ) {\n      // To be able to call functions within this object\n      var that = this;\n\n      // Check if block is unique\n      if ( !block_config.isUnique ) {\n        var blockIcon = $('<span class=\"dtable icon\"><span class=\"dtable-cell\"></span></span>');\n        var blockCaption = $();\n\n        if (block_config.icon in this.icons) {\n          blockIcon.find('.dtable-cell').html(this.icons[block_config.icon]);\n          var caption = block_config.icon;\n          if ('caption' in block_config) caption = block_config.caption;\n          blockCaption = $('<span class=\"dblock\">' + caption + '</span>');\n        } else {\n          blockIcon = $(block_config.icon);\n        }\n        var link = $('<a class=\"dtf-block-choice\" href=\"#\">')\n              .attr('data-block-name', name)\n              .append(blockIcon);\n        if (blockCaption.length) {\n          link.append(blockCaption);\n        }\n\n        // Test changeable class in configuration.json\n        if ( typeof block_config.listChangeable === \"undefined\" ) {\n\n          $(block_config.selector).addClass('dtf-draggable');\n          this.blocks.first().append(link);\n\n        } else {\n\n          $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n          var existBlockDom = {\n            \"html\": $(block_config.selector).first().clone(true, true),\n            \"divClass\": $(block_config.selector).closest(\"div\").attr(\"class\")\n          };\n          dom = existBlockDom;\n          $(block_config.selector).addClass('dtf-draggable');\n          this.blocks.first().append(link);\n\n        }\n\n        //Duplicate exist DOM element and add to layout\n        link.on('click', function() {\n          var dom_block = that.get_dom($(this).attr('data-block-name'));\n          dom_block.addClass('dtf-draggable dtf-block');\n\n          var new_row = $(window.templates.baseBlock);\n          new_row.find('.dtf-block')\n            .replaceWith(dom_block);\n\n          var divClass = that.get_divClass($(this).attr('data-block-name'));\n\n          new_row.addClass(divClass);\n\n          var draft_row = $(this).closest('div.dtf-tr-element');\n          draft_row.after(new_row.css('display', 'none'));\n\n          if ( dom_block.hasClass('dtf-changeable') ) {\n            dtfLayoutMode.changeClass(dom_block);\n          } else {\n            dtfLayoutMode.equipBlock(dom_block);\n          }\n          new_row.show(100);\n\n          undoBtn.flash();\n\n          actionStack.push(function(){\n            dtfLayoutMode.deleteBlock(dom_block);\n          });\n\n          return false;\n        });\n\n      } else if ( block_config.isUnique && typeof block_config.listChangeable !== \"undefined\" ){\n\n        $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n        $(block_config.selector).addClass('isUnique');\n\n      } else {\n\n        $(block_config.selector).addClass('isUnique');\n\n      }\n      this.doms[name] = dom;\n      this.configs[name] = block_config;\n    }\n  };\n\n  /**\n   * Gets all the block config and initialize them\n   */\n  var _fetchBlocksConfig = function () {\n    _.forOwn(blocks_config.styles, function (config, name) {\n      var existBlockDom = {\n        \"html\": $(config.selector).first().clone(true, true),\n        \"divClass\": $(config.selector).closest(\"div\").attr(\"class\")\n      };\n      blocksCatalog.add(name, config, existBlockDom);\n\n      if ( config.urlckEditor !== undefined ) {\n        // Get CKEditor config URL from config\n        var ckEditorUrl = getAbsoluteUrl(config.urlckEditor);\n\n        // Fetch CKEditor config\n        $.getJSON(ckEditorUrl, function(data) {\n          // Set CKEditor language to global lang\n          data.ckEditor.language = settings.lang;\n\n          // Initialize the content editables in the block\n          $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor(data.ckEditor);\n          // Save the block config for future use\n          localStorage.setItem(config.selector,JSON.stringify(data.ckEditor));\n        });\n\n      } else {\n\n        // Initialize the content editables in the block with default config\n        $(config.selector).find('.dtf-contentEditable')\n        .attr('contentEditable', true)\n        .ckeditor({language: settings.lang});\n\n      }\n    });\n\n    dtfContentMode.enter();\n\n  };\n\n  /* Remove data attributes\n   */\n  var _removeDataAttributes = function ($target) {\n    if ( 0 !== $target.length ) {\n      var i,\n          attrName,\n          dataAttrsToDelete = [],\n          dataAttrs = $target.get(0).attributes,\n          dataAttrsLen = dataAttrs.length;\n\n      // Loop through attributes and make a list of those\n      // that begin with 'data-'\n      for (i=0; i<dataAttrsLen; i++) {\n          if ( 'data-' === dataAttrs[i].name.substring(0,5) ) {\n              // Why don't we just delete the attributes here?\n              // Deleting an attribute changes the indices of the\n              // others wreaking havoc on the loop we are inside\n              // b/c dataAttrs is a NamedNodeMap (not an array or obj)\n              dataAttrsToDelete.push(dataAttrs[i].name);\n          }\n      }\n      // Delete each of the attributes we found above\n      // i.e. those that start with \"data-\"\n      $.each( dataAttrsToDelete, function( index, attrName ) {\n          $target.removeAttr( attrName );\n      });\n    }\n  };\n\n  var _generateFinal = function ( html ) {\n    if ( undefined === html || null === html) {\n      error('No HTML provided, cannot generate final document');\n      setMessage($.t('editor.valid_error'), 'error');\n    } else {\n\n      spinner('show');\n      // Get the custom styles\n      var styles = getUserStyles();\n\n      // Load the boilerplate from the server\n      var boilerplateURL = settings.appRootUrl + 'final-boilerplate.html';\n      $.get(boilerplateURL, function (boilerplate) {\n        // Insert user bits\n        boilerplate = boilerplate.replace('[[USER_TITLE]]', settings.title);\n        boilerplate = boilerplate.replace('[[USER_STYLES]]', styles);\n        boilerplate = boilerplate.replace('[[USER_CONTENT]]', html);\n        boilerplate = boilerplate.replace('[[USER_NOINLINE_ATTR]]', settings.noinlineAttr);\n\n        // Remove CSS comments\n        boilerplate = boilerplate.replace(/\\/\\*(.|[\\r\\n])*?\\*\\//g, \"\");\n        // Remove blank lines for good measure\n        boilerplate = boilerplate.replace(/^\\s*[\\r\\n]/gm, \"\");\n\n        parent.postMessage(msgPrefix + boilerplate, \"*\");\n\n        spinner('hide');\n        setMessage($.t('editor.valid_ok'), 'valid', false);\n        // Lock the editor\n        _lockEdition(true);\n      })\n      .fail(function () {\n        warn('Could not get boilerplate from server, aborting content export');\n        spinner('hide');\n        setMessage($.t('editor.valid_error'), 'error');\n      });\n    }\n  };\n\n  var getUserStyles = function () {\n    // Get the styles\n    // we actually fetch all the content of <head> and remove unwanted bits\n    // to be able to keep parts wrapped in comments like <!--[if gte mso 9]>\n    var $head = $('head').clone();\n    $head.find('title,meta,link, script, style:not([data-userstyle])').remove();\n    _removeDataAttributes($head.find('style'));\n\n    return unescape($head.html());\n\n  };\n\n  String.prototype.htmlEncode = function() {\n    var charsToReplace = {\n      '“': '&ldquo;',\n      '”': '&rdquo;'\n    };\n    return this.replace(/[“”]/g, function(char) {\n        return charsToReplace[char] || char;\n    });\n  };\n\n  var getContent = function ( cleanup ) {\n    if ( undefined === cleanup) cleanup = false;\n\n    try {\n      // Disable the editor, removes the content editables and other stuff\n      dtfContentMode.leave();\n      // Clone the content div\n      var $content = $('#dtf-content').clone();\n\n      // Dump the raw html\n      var html = $content.html();\n\n      // Re-enable the editor\n      dtfContentMode.enter();\n\n      if (cleanup) {\n        // Do some more cleanup\n\n        // First get all the uploadable images sizes\n        // and set their attributes accordingly\n        $content.find('.dtf-imageUploadable').each(function() {\n          var width = $(this)[0].naturalWidth;\n          var height = $(this)[0].naturalHeight;\n          if ( $(this).width() !== 0 ) {\n            // Not a stock image, so get real size (possibly resized)\n            width = $(this).width();\n            height = $(this).height();\n          }\n          $(this).attr('width', width);\n          $(this).attr('height', height);\n          $(this).removeAttr('class style');\n        });\n\n\n        $content.find('.dtf-upload').remove();\n        _removeDataAttributes($content.find('.dtf-changeable'));\n        $content.find('.dtf-contentEditable').removeAttr('contenteditable style');\n        //Remove dentifrice Classes\n        $content.find('*[class*=\"dtf\"]').removeClass (function (index, css) {\n          return (css.match (/(^|\\s)dtf-\\S+/g) || []).join(' ');\n        });\n        $content.find('.isUnique').removeClass(\"isUnique\");\n\n        //Add table conditional IE\n        $content.find('#templateContainer td:first > div').each(function() {\n          $(this).before('<!--[if (gte mso 9)|(IE)]><table cellpadding=\"0\" cellspacing=\"0\" width=\"600\" align=\"center\"><tr><td><![endif]-->');\n          $(this).after('<!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->');\n        })\n        //Remove dtf Classes\n        html = html.replace(/dtf.* /g, \"\");\n      }\n\n      // HTML-encode some characters in the tags that might contain text,\n      // in order to avoid mangling further down the chain\n      // especially with UTF-8 encoding on POST (smart quotes for example)\n      html = html.htmlEncode();\n\n      // Remove no IE comments\n      html = html.replace(/<!--(?!\\[if).*?-->/g, \"\");\n\n      return html;\n\n    } catch(err) {\n      return null;\n    }\n  };\n\n  /**\n   * An action stack to allow undo-ing actions\n   */\n  var actionStack = {\n    stack : [],\n    // Push an undo function to the stack\n    push: function (func) {\n      this.stack.push(func);\n    },\n    // Calls the latest pushed function\n    undo: function() {\n      var last_el = this.stack.pop();\n      if (last_el) {\n        last_el();\n      } else {\n        info('nothing to undo');\n      }\n    },\n  };\n\n  /**\n   * A controller for an undo button based on an action stack\n   */\n  var UndoButton = function(el, stack) {\n    this.el = $(el);\n    this.stack = stack;\n\n    this.el.on('click', function(){\n      stack.undo();\n    });\n  };\n\n  UndoButton.prototype.flash = function(){\n    var btn = this.el;\n    var flash_color = 'rgb(202, 60, 60)';\n    var orig_color = btn.css('background-color');\n\n    btn.animate(\n      {backgroundColor: flash_color}, 100,\n      function() {\n        btn.animate({backgroundColor: orig_color}, 100);\n      }\n    );\n  };\n\n  var _lockEdition = function (lock) {\n    if (lock) {\n      $('.overlay').show();\n      $('#getList').hide();\n      $('#dtf-layout-mode').hide();\n      $('#saveDraft').hide();\n      $('#validateBtn').hide();\n      $('#resumeBtn').show();\n    } else {\n      $('#resumeBtn').hide();\n      $('#getList').show();\n      $('#dtf-layout-mode').show();\n      $('#saveDraft').show();\n      $('#validateBtn').show();\n      $('#messages').fadeOut(100);\n      $('.overlay').fadeOut(100);\n    }\n  };\n\n  var _loadToolbar = function () {\n    if ( !$('#dtf-toolbar').length ) {\n      var toolbar = $(window.templates.layoutToolbar);\n      undoBtn = new UndoButton(toolbar.find('#undoBtn'), actionStack);\n\n      var layoutModeBtn = toolbar.find('#dtf-layout-mode');\n    \tlayoutModeBtn.on('click', function() {\n    \t\t$('#saveDraft').hide();\n        $('#validateBtn').hide();\n    \t\t$.proxy(dtfContentMode.leave,this)();\n    \t\t$.proxy(dtfLayoutMode.enter,this)();\n    \t});\n\n      var contentModeBtn  = toolbar.find('#dtf-content-mode');\n    \tcontentModeBtn.on('click', function() {\n    \t\t$('#saveDraft').show();\n        $('#validateBtn').show();\n    \t\t$.proxy(dtfLayoutMode.leave,this)();\n    \t\t// use setTimeout to let animation finish before we do heavy work\n    \t\t// otherwise, animation gets glitched.\n    \t\twindow.setTimeout(\n    \t\t\t$.proxy(dtfContentMode.enter,this),\n    \t\t\t100\n    \t\t);\n    \t});\n\n      var validateBtn = toolbar.find('#validateBtn');\n      validateBtn.on('click', function() {\n        // Generate final content and post to parent\n        _generateFinal(getContent(true));\n    \t});\n\n      var resumeBtn = toolbar.find('#resumeBtn');\n      resumeBtn.on('click', function() {\n        // We post an empty content to empty the parent textarea\n        // and force a new validation of the content\n        parent.postMessage(msgPrefix, \"*\");\n        // Unlock the editor\n        _lockEdition(false);\n    \t});\n\n      var containerListDraft = toolbar.find('#containerListDraft');\n\n      var saveDraftBtn = toolbar.find('#saveDraft');\n      saveDraftBtn.on('click', function() {\n    \t\tdtfDraftsManager.saveDraft();\n    \t});\n\n      var draftsListBtn = toolbar.find('#getList');\n    \tdraftsListBtn.on('click', function() {\n    \t\tdtfDraftsManager.listDrafts();\n        containerListDraft.addClass('isActive');\n    \t});\n\n      var closeDraftsListBtn = toolbar.find('#closeListDraft');\n    \tcloseDraftsListBtn.on('click', function() {\n    \t\tcontainerListDraft.removeClass('isActive');\n    \t});\n\n      $('body').append(toolbar);\n\n      // Resume button needs to be hidden first\n      $('#resumeBtn').hide();\n\n      toolbar.i18n();\n\n      $('body').addClass('toolbarVisible');\n    }\n  };\n\n  /**\n   * Displays a notification on top of the editor\n   */\n  var setMessage = function ( text, status, temp ) {\n    if (undefined === temp) temp = true;\n\n    if ( !$('#messages').length ) {\n      $('body').append($(window.templates.layoutMessages));\n    }\n\n    $(\"#messages\").attr('class', '');\n    $('#messages')\n      .text(text)\n      .addClass(status)\n      .fadeIn(300);\n    if (temp) {\n      $('#messages')\n        .delay(2500)\n        .fadeOut(100);\n    }\n  };\n\n  var flashUndo = function () {\n    undoBtn.flash();\n  };\n\n  var pushToStack = function ( fn ) {\n    actionStack.push(fn);\n  };\n\n  /**\n   * Load the editor\n   */\n  var load = function () {\n    _fetchBlocksConfig();\n    _loadToolbar();\n    _loadToolbar();\n  };\n\n  // Some scoped global variables\n  var undoBtn;\n\n  // Return public methods\n  return {\n    blocksCatalog : blocksCatalog,\n    setMessage    : setMessage,\n    flashUndo     : flashUndo,\n    pushToStack   : pushToStack,\n    getContent   : getContent,\n    getUserStyles : getUserStyles,\n    load          : load\n  };\n\n}( jQuery ));\n"],"sourceRoot":"/source/"}