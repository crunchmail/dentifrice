/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
var iframeID="dentifriceIframe",msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,lang="en",target,dentifrice=function(){"use strict";var e={},t={targetId:"dentifrice-textarea",templateUrl:null,stylesUrl:"styles.html",configUrl:"configuration.json",title:"Dentifrice Newsletter",lang:null,log:!0,debug:!1,hideTarget:!0,anchorId:null,replaceAnchor:!1,width:850,height:parseInt(.8*window.outerHeight)},n={en:{"Please validate":"Please validate your edition first !"},fr:{"Please validate":"Veuillez valider l'Ã©diteur !"}},i=function(){var t=navigator.language||navigator.userLanguage;e.lang&&e.lang in n?lang=e.lang:t in n&&(lang=t),logger._debug("Setting locale to: "+lang)},r=function(e){var t=n[lang];return e in t?t[e]:e},o=function(n){for(var i in t)t.hasOwnProperty(i)&&(e[i]=n.hasOwnProperty(i)?n[i]:t[i])},a=function(){var t=document.getElementById(e.targetId);return t&&0!==t.length?(logger._debug("Found element matching selector: "+e.targetId),t):(logger._warn("Could not find element with ID: "+e.targetId),!1)},g=function(){if(null===document.getElementById("dentifriceValidationAlert")){var t=document.getElementById(iframeID),n=document.createElement("div");n.id="dentifriceValidationAlert",n.textContent=r("Please validate"),t.parentNode.insertBefore(n,t);var i=t.getBoundingClientRect(),o=i.top+t.parentNode.scrollTop,a=n.offsetHeight,g=n.offsetWidth,l=parseFloat(o)-parseFloat(a)-4,s=parseFloat(e.width)-parseFloat(g);n.style.cssText="position: relative; top: -10px; left: "+s+"px; opacity: 1;",window.scrollTo(0,l-50),setTimeout(function(){null!==n.parentNode&&n.parentNode.removeChild(n)},2e3)}},l=function(e){logger._info("Initializing settings"),o(e),logger._info("Initializing locale"),i(),logger._info("Getting target element"),target=a(),logger._info("Setting up postMessages listener"),dentifrice_postMessage.setupMessageListener()};return{checkIfValidated:function(){return""===target.value?(g(),!1):!0},getSettings:function(){return e},init_dentifrice:l,bootstrap:function(t){return l(t),e.templateUrl?target?(logger._info("Initializing editor"),_initEditor.init(),!0):(logger._warn("Target element not found, aborting"),!1):(logger._warn("No template URL provided"),!1)}}}(),logger=function(){var e=dentifrice.getSettings(),t=function(e,t,n){!0===n&&"object"==typeof window.console&&console[e]("Dentifrice: "+t)};return{_warn:function(e){t("warn",e,!0)},_info:function(n){t("info",n,e.log)},_debug:function(n){t("log",n,e.debug)}}}(),dentifrice_postMessage=function(){var e=function(){var e=window.addEventListener?"addEventListener":"attachEvent",t=window[e],i="attachEvent"==e?"onmessage":"message";t(i,n,!1)},t={final_html:function(e){return e.content}},n=function(e){function n(){return msgPrefix===(""+i).substr(0,msgPrefixLen)}var i=e.data;if(i.length>msgPrefixLen&&"string"==typeof i&&n()){logger._debug("Received postmessage :"+i);var r=JSON.parse(i.substr(msgPrefixLen));t.hasOwnProperty(r.type)?target.value=t[r.type](r):logger._warn("Type undefined")}else logger._debug("Received postmessage, but not for us :"+i)};return{setupMessageListener:e,type:t}}(),_initEditor=function(){var e=function(){dentifrice_settings=dentifrice.getSettings(),dentifrice_settings.hideTarget&&(target.style.display="none");var e=dentifrice_settings.templateUrl.replace(/\/[^\/]*$/,"/"),t=/^https?:\/\/|^\/\//i,n=encodeURIComponent(dentifrice_settings.templateUrl),i=encodeURIComponent(e+dentifrice_settings.stylesUrl);t.test(dentifrice_settings.stylesUrl)&&(i=encodeURIComponent(dentifrice_settings.stylesUrl));var r=encodeURIComponent(e+dentifrice_settings.configUrl);t.test(dentifrice_settings.configUrl)&&(r=encodeURIComponent(dentifrice_settings.configUrl));var o="",a=document.getElementsByTagName("script"),g=/^(.*)dentifrice\.(min\.)*js(.*)/;[].forEach.call(a,function(e){var t=e.getAttribute("src"),n=g.exec(t);n&&(o=n[1])});var l=o+"editor.html?template="+n+"&styles="+i+"&config="+r+"&lang="+lang+"&title="+dentifrice_settings.title,s=document.createElement("iframe");if(s.id=iframeID,s.setAttribute("src",l),s.style.border="0",s.style.width=dentifrice_settings.width+"px",s.style.height=dentifrice_settings.height+"px",dentifrice_settings.anchorId){var d=document.getElementById(dentifrice_settings.anchorId);0===d.length?logger._warn("Could not find anchor element with ID: "+dentifrice_settings.anchorId):(logger._debug("Found anchor element with ID: "+dentifrice_settings.anchorId),dentifrice_settings.replaceAnchor?(logger._debug("Replacing anchor element with editor"),d.parentNode.replaceChild(s,d)):(logger._debug("Inserting editor inside anchor element"),d.appendChild(s)))}else target.parentNode.insertBefore(s,target.nextSibling)};return{init:e}}();
//# sourceMappingURL=dentifrice.min.js.map