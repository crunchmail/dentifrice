/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
function error(t){output("error",t,!0)}function warn(t){output("warn",t,!0)}function info(t){output("info",t,settings.log)}function debug(t){output("log",t,settings.debug)}function output(t,i,e){!0===e&&"object"==typeof window.console&&console[t]("DentifriceEditor: "+i)}function loadSettings(t){var i={log:!0,debug:!1,showSpinner:!0,noinlineAttr:'inline="false"',uploadURL:"http://localhost:8080/files",plugins:{draftStore:"drafts-localstore.js",uploadStore:"upload-simplestore.js",beforeEditor:[],afterEditor:[]}};settings=_.merge(i,t),CKEDITOR_BASEPATH=settings.appRootUrl+"/ckeditor/"}function _init(t){t.appRootUrl=appRootUrl,t.lang=lang,t.title=title,loadSettings(t),dtfInit.loadEditor(dtfInit.loadI18n(function(){info("Initializing editor"),dtfEditor.load(),spinner("hide")}))}function _getQueryParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=i.exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}var msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,title,lang,appRootUrl,postMessage=function(){var t=function(t,i){messageToSend={type:t,content:i},parent.postMessage(msgPrefix+JSON.stringify(messageToSend),"*")};return{post:t}}(),blocksIcons={title:'<i class="icon-text">T</i>',paragraph:'<i class="fa fa-2x fa-align-justify"></i>',image:'<i class="fa fa-2x fa-picture-o"></i>',"1col_image_top":'<i class="fa fa-2x fa-picture-o"></i><br /><i class="fa fa-2x fa fa-align-justify"></i>',"2cols_image_top":'<i class="fa fa-2x fa-picture-o"></i><i class="fa fa-2x fa-picture-o"></i><br /><i class="fa fa-2x fa fa-align-justify"></i><i class="fa fa-2x fa fa-align-justify"></i>',"2cols_image_bottom":'<i class="fa fa-2x fa fa-align-justify"></i><i class="fa fa-2x fa fa-align-justify"></i><br /><i class="fa fa-2x fa-picture-o"></i><i class="fa fa-2x fa-picture-o"></i>',quote:'<i class="icon-text icon-quote">&rdquo;</i>',mixed_image_left:'<i class="fa fa-2x fa-picture-o"></i><i class="fa fa-2x fa-align-justify"></i>',mixed_image_right:'<i class="fa fa-2x fa-align-justify"></i><i class="fa fa-2x fa-picture-o"></i>',mixed_image_top:'<i class="fa fa-2x fa-picture-o"></i><br /><i class="fa fa-2x fa-align-justify"></i>',mixed_image_bottom:'<i class="fa fa-2x fa-align-justify"></i><br /><i class="fa fa-2x fa-picture-o"></i>'},settings={},CKEDITOR_BASEPATH,getAbsoluteUrl=function(t){var i=new RegExp("^(?:[a-z]+:)?//","i");return i.test(t)?t:settings.appRootUrl+t.replace(/^\//,"")},spinner=function(t){var i=$(".overlay"),e=$(".spinner"),a=window.innerWidth/2-e.width()/2;if(e.css("left",a),settings.showSpinner)switch(t){case"show":debug("Showing spinner"),i.show(),e.show();break;case"hide":debug("Hiding spinner"),e.hide(),i.hide();break;default:warn("Unknown spinner action")}},blocks_config={styles:{}},dtfInit=function(t){"use strict";var i=function(e,a,n,o){"string"==typeof e&&(e=[e]),debug("Loading script: "+e[a]),t.getScript(e[a],function(){a+1<=e.length-1?i(e,a+1,n,o):n&&n()}).fail(function(t,i,n){warn(e[a]+" loading error: "+n),o&&o()})},e=function(i){info("Initializing locale"),t.i18n.init({lng:settings.lang,fallbackLng:"en",lowerCaseLng:!0,resGetPath:settings.appRootUrl+"locales/__lng__.json",useLocalStorage:!1,debug:settings.debug},function(){i&&i()})},a=function(t,e){spinner("show");var a=[settings.appRootUrl+"js/plugins/"+settings.plugins.draftStore,settings.appRootUrl+"js/plugins/"+settings.plugins.uploadStore];"string"==typeof settings.plugins.beforeEditor&&(settings.plugins.beforeEditor=[settings.plugins.beforeEditor]);var n=settings.plugins.beforeEditor.map(function(t){return getAbsoluteUrl(t)});a=a.concat(n),a.push(settings.appRootUrl+"js/editor.min.js"),"string"==typeof settings.plugins.afterEditor&&(settings.plugins.afterEditor=[settings.plugins.afterEditor]);var o=settings.plugins.afterEditor.map(function(t){return getAbsoluteUrl(t)});a=a.concat(o),i(a,0,function(){t&&t()},function(){e&&e()})};return{loadScripts:i,loadI18n:e,loadEditor:a}}(jQuery);!function(t){var i=location.href;appRootUrl=i.substring(0,i.lastIndexOf("/")+1);var e=appRootUrl+"_local_settings.js",a=_getQueryParameterByName("template"),n=_getQueryParameterByName("styles"),o=_getQueryParameterByName("config");lang=_getQueryParameterByName("lang"),title=_getQueryParameterByName("title"),t("#dtf-content").load(a,function(i,a,s){"error"==a?error("Could not load template URL "+templateURL+": "+s.status+" "+s.statusText):(debug("Template loaded"),t.get(n,function(i){var a=t("<tmp/>").html(i);a.find("style").attr("data-userstyle",!0),a.contents().appendTo("head"),debug("Styles loaded"),t.getJSON(o,function(t){debug("Configuration loaded"),blocks_config=t,dtfInit.loadScripts(e,0,function(){_init(local_settings)},function(){var t={};_init(t)})}).fail(function(){error("Could not load configuration URL:"+configURL)})}).fail(function(){error("Could not load styles URL:"+stylesURL)}))})}(jQuery);
//# sourceMappingURL=init.min.js.map