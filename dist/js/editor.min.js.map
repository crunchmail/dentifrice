{"version":3,"sources":["content-mode.js","layout-mode.js","drafts-manager.js","uploadify.js","editor.js"],"names":["dtfContentMode","$","attrHref","enter","info","each","dtfEditor","blocksCatalog","configs","name","config","selector","addClass","undefined","urlckEditor","confCkeditor","JSON","parse","localStorage","getItem","find","attr","ckeditor","addBack","filter","uploadify","closest","length","parent","removeAttr","makeResizable","is","show","contentLinks","debug","this","href","on","event","preventDefault","leave","CKEDITOR","instances","_","instance","destroy","removeClass","resizable","remove","unwrap","data","jQuery","dtfLayoutMode","_draggable","block","parent_div","sortable","items","placeholder","revert","scrollSpeed","sort","ui","centerElement","height","item","topElement","offset","top","windowPos","parseFloat","window","scrollTop","start","css","scrollTo","stop","hasClass","changeClass","equipBlock","_addDelBtn","prev","templates","blockDelButton","insertBefore","element","next","row","before_row","row_parent","removed","deleteBlock","hide","pushToStack","after","prepend","_hide_catalog","_show_catalog","html","get_gallery","numberOfElement","i","draft_row","blockAddBar","fadeIn","blockClass","draft_rowAdd","blockChange","classesElement","removeOldClasse","split","join","arrClass","append","nameClass","deleted","add","clone","dtfDraftsManager","saveDraft","checkingFunction","val","setMessage","t","spinner","resultPrompt","prompt","save","draftStore","draftExists","confirm","date","Date","toLocaleDateString","toLocaleTimeString","getContent","styles","getUserStyles","blocks_config","hideMenu","listDrafts","draftsListUl","empty","list","forEach","draft","draftLi","id","spanDate","spanName","spanDelete","e","loadDraft","err","deleteDraft","stopPropagation","deleteAllDrafts","removeChild","document","getElementById","v","parentNode","getAttribute","fn","idx","el","img","maxWidthResizable","Math","round","naturalHeight","naturalWidth","width","configResizable","maxWidth","minWidth","aspectRatio","handles","showUploadForm","showFormButton","fileInput","browseBtn","waiter","uploadForm","hideUploadForm","startWaiting","imageUploadForm","imageUploadButton","imgWidth","i18n","wrap","closeLink","click","change","fd","FormData","file","files","url","uploadStore","doUpload","dataResizable","newImg","replaceWith","setTimeout","undoBtn","blocks","doms","icons","title","paragraph","image","1col_image_top","2cols_image_top","2cols_image_bottom","quote","mixed_image_left","mixed_image_right","mixed_image_top","mixed_image_bottom","children","get_dom","get_divClass","divClass","block_config","dom","that","isUnique","listChangeable","blockIcon","blockCaption","icon","caption","link","first","existBlockDom","dom_block","new_row","baseBlock","actionStack","push","_fetchBlocksConfig","forOwn","ckEditorUrl","getAbsoluteUrl","getJSON","ckEditor","language","settings","lang","setItem","stringify","_removeDataAttributes","$target","dataAttrsToDelete","dataAttrs","get","attributes","dataAttrsLen","substring","index","attrName","_generateFinal","error","boilerplateURL","appRootUrl","boilerplate","replace","noinlineAttr","postMessage","msgPrefix","_lockEdition","fail","warn","$head","unescape","String","prototype","htmlEncode","charsToReplace","“","”","char","cleanup","$content","match","before","stack","func","undo","last_el","pop","UndoButton","flash","btn","flash_color","orig_color","animate","backgroundColor","lock","fadeOut","addItemDropDown","li","_loadToolbar","toolbar","layoutToolbar","layoutModeBtn","proxy","contentModeBtn","validateBtn","resumeBtn","containerListDraft","saveDraftBtn","draftsListBtn","closeDraftsListBtn","text","status","temp","layoutMessages","delay","load"],"mappings":"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","file":"editor.min.js","sourcesContent":["// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfContentMode = (function( $ ) {\n  'use strict';\n\n  var attrHref;\n\n  var enter = function() {\n    info('Entering ContentMode');\n\n    $.each(dtfEditor.blocksCatalog.configs, function(name, config) {\n      // Add CKEditor instances\n      $(config.selector).addClass('dtf-block');\n      if(config.urlckEditor !== undefined) {\n        //get localStorage json file\n        var confCkeditor = JSON.parse(localStorage.getItem(config.selector));\n        $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor(confCkeditor);\n      }\n      else {\n        $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor();\n      }\n\n      // Add controls around uploadable images\n      $(config.selector).find('*').addBack()\n        .filter('.dtf-imageUploadable')\n        .uploadify();\n\n      if($(config.selector).find('.dtf-imageUploadable').closest('a').length > 0) {\n\n        attrHref = $(config.selector).find('.dtf-imageUploadable').parent('a').attr('href');\n        $(config.selector)\n          .find('.dtf-imageUploadable').parent('a')\n          .removeAttr('href')\n          .attr('data-href', attrHref);\n      }\n\n      // Add controls for resizable images\n      $(config.selector).find('*').addBack()\n        .filter('.dtf-resizable')\n        .makeResizable();\n\n      if($('.ui-resizable-handle').is(':hidden')) {\n        $('.ui-resizable-handle').show();\n      }\n\n      // Disable click on all links outside content editables\n      var contentLinks = $('#dtf-content a:not(.cke_editable a)');\n      contentLinks.each(function () {\n        debug('Disabling clicks on link: ' + this.href);\n      });\n      contentLinks.on('click', function(event) {\n        event.preventDefault();\n      });\n    });\n  };\n\n  var leave = function() {\n    info('Leaving ContentMode');\n    // Remove content-editables\n    $.each(CKEDITOR.instances, function (_, instance) {\n      instance.destroy();\n    });\n    $('.dtf-contentEditable').attr('contentEditable', false);\n    $('.sortable-element').removeClass('sortable-element');\n\n    // Remove controls for resizable images\n    $('.dtf-resizable').resizable(\"destroy\");\n    // Remove controls uploadable image\n    $('.dtf-image-wrap').find(':not(.dtf-imageUploadable)').remove();\n    $('img.dtf-imageUploadable').unwrap();\n\n    if($('.dtf-imageUploadable').closest('a').length > 0) {\n      attrHref = $('.dtf-imageUploadable').parent('a').data('href');\n\n      $('.dtf-imageUploadable').parent('a')\n        .removeAttr('data-href')\n        .attr('href', attrHref);\n    }\n  };\n\n  return {\n    enter : enter,\n    leave : leave,\n  };\n\n})( jQuery );\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfLayoutMode = (function( $ ) {\n  'use strict';\n\n  var _draggable = function(block) {\n    var parent_div = block.closest('div'),\n      c = {};\n\n    parent_div.addClass('sortable-element');\n\n    $('#templateContainer').sortable({\n      items: '.sortable-element',\n      placeholder: \"ui-state-highlight\",\n      revert: true,\n      scrollSpeed: 40,\n      sort: function(event, ui) {\n        var containerHeight = $('#templateContainer').height()/2;\n        var centerElement = (ui.item.height()/2)/2;\n        var topElement = ui.item.offset().top/2;\n        var windowPos = parseFloat(topElement) + parseFloat(centerElement);\n        $(window).scrollTop(windowPos);\n      },\n      start: function(event, ui) {\n        ui.placeholder.height(ui.item.height());\n        $('.dtf-tr-element').remove();\n        $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 0.5);\n        var centerElement = (ui.item.height()/2);\n        var topElement = ui.item.offset().top;\n        var windowPos = parseFloat(topElement) + parseFloat(centerElement) - 100;\n        window.scrollTo(0, windowPos);\n      },\n      stop: function(event, ui) {\n        $('.button-del').remove();\n        $('.dtf-block').each(function() {\n          if($(this).hasClass('dtf-changeable')) {\n            changeClass($(this));\n          }else {\n            equipBlock($(this));\n          }\n        });\n        $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 1);\n      }\n    });\n  };\n\n  var _addDelBtn = function(block) {\n    if (block.prev('.pure-button-del').length <= 0 && !block.hasClass('isUnique')) {\n      $(window.templates.blockDelButton)\n        .insertBefore(block)\n        .on('click', function(){\n          var element = $(this).next();\n          var row = element.closest('tr');\n          var before_row = row.prev();\n          var row_parent = row.parent();\n          var next_draft = row.next('tr');\n          var removed = deleteBlock(element).hide();\n          dtfEditor.pushToStack(function(){\n            // Record previous element or parent if first\n            if (before_row.length > 0) {\n              before_row.after(removed);\n            } else {\n              row_parent.prepend(removed);\n            }\n            removed.show(200);\n          });\n        });\n    }\n  };\n\n  var _hide_catalog = function() {\n    $('.dtf-catalog').hide(100);\n    $('.dtf-add-bar .button-add:hidden').show(100);\n  };\n\n  var _show_catalog = function() {\n    _hide_catalog();\n    $(this).hide(100);\n\n    // show my catalog\n    $(this).closest('div').find('.dtf-catalog')\n      .html(dtfEditor.blocksCatalog.get_gallery())\n      .show(100);\n  };\n\n  var enter = function() {\n    info('Entering LayoutMode');\n\n    var numberOfElement = $('.dtf-block').length;\n    $('.dtf-block').each(function(i) {\n      //addClass lastClass to last element\n      if(i === numberOfElement - 1 ) $(this).addClass('lastChild');\n      if(!$(this).hasClass('dtf-changeable')) {\n        equipBlock($(this));\n        _draggable($('.dtf-draggable'));\n      }else {\n        changeClass($(this));\n      }\n    });\n\n    // Block adding\n    $('.first-hidden').show(100);\n    $(this).hide(100);\n  };\n\n  var leave = function() {\n    info('Leaving LayoutMode');\n\n    $('.dtf-draft-block').closest('div').remove();\n    $('.button-del').remove();\n    $('.first-hidden').hide(100);\n    $('#dtf-layout-mode').show(100);\n    $('.dtf-deletion-border').removeClass('dtf-deletion-border');\n    $( \"#templateContainer\" ).sortable( \"destroy\" );\n  };\n\n  /**\n   * Equips a block with a border and block inserting tool under it.\n   */\n  var equipBlock = function(block) {\n    var parent_div = block.closest('div');\n\n    block.addClass('dtf-deletion-border');\n    if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n      var draft_row = $(window.templates.blockAddBar);\n      draft_row.find('button').on('click', _show_catalog);\n      _hide_catalog();\n\n      parent_div.after(draft_row.fadeIn());\n    }\n\n    //Add button delete block if not Unique\n    _addDelBtn(block);\n\n  };\n\n  //Change Class of element with listChangeable in configuration.json\n  var changeClass = function(block, blockClass) {\n    var parent_div = block.closest('div');\n    //console.log(parent_div.find('.dtf-block'));\n\n    block.addClass('dtf-deletion-border');\n    if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n      if(!block.hasClass('lastChild')) {\n        var draft_rowAdd = $(window.templates.blockAddBar);\n\n        draft_rowAdd.find('button').on('click', _show_catalog);\n        _hide_catalog();\n\n        parent_div.after(draft_rowAdd.fadeIn());\n      }\n\n      var draft_row = $(window.templates.blockChange);\n      var classesElement = parent_div.find('.dtf-block').data('change-class');\n      var removeOldClasse = classesElement.split(',').join(' ');\n      var arrClass = classesElement.split(',');\n\n      parent_div.after(draft_row);\n\n      $.each(arrClass, function() {\n        if(block.closest('div').find('.dtf-block').hasClass(this)) {\n          draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"active dtf-background '+this+'\"></div>');\n\n        }else {\n          draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"dtf-background '+this+'\"></div>');\n        }\n\n      });\n\n      block.closest('div').next().on('click', '.dtf-background', function() {\n        $('.dtf-background').removeClass('active');\n        $(this).addClass('active');\n        draft_row.prev().find('.dtf-block').removeClass(removeOldClasse);\n        var nameClass = $(this).data('background');\n        draft_row.prev().find('.dtf-block').addClass(nameClass);\n\n      });\n    }\n\n    //Add button delete block if not Unique\n    _addDelBtn(block);\n  };\n\n  var deleteBlock = function (block) {\n    /* the setattr is a woraround to avoid getting a hidden forever\n     * cloned element\n     */\n    var parent_div = block.closest('div');\n    var deleted;\n    //console.log(parent_div.next('div'));\n    if(block.hasClass(\"dtf-changeable\")) {\n      deleted = $().add(parent_div).add(parent_div.next('div')).add(parent_div.next('div').next('div'));\n    }else {\n      deleted = $().add(parent_div).add(parent_div.next('div'));\n    }\n\n    var clone = deleted.clone(true, true);\n    deleted.hide(200, function() {\n      $(this).remove();\n    });\n    return clone;\n  };\n\n  return {\n    enter       : enter,\n    leave       : leave,\n    changeClass : changeClass,\n    equipBlock  : equipBlock,\n    deleteBlock : deleteBlock\n  };\n\n})( jQuery );\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfDraftsManager = (function( $ ) {\n  'use strict';\n\n  var versionTpl = 1;\n  var containerListDraft = $('containerListDraft');\n\n  var saveDraft = function() {\n    spinner('show');\n    var resultPrompt = prompt($.t('drafts.name_prompt'), $.t('drafts.default_name'));\n\n    if ( resultPrompt !== \"\" && resultPrompt !== null ) {\n      var save = true;\n\n      if ( draftStore.draftExists(resultPrompt) ) {\n        info('Draft name already exist: ' + resultPrompt);\n        save = confirm($.t('drafts.overwrite_confirm'));\n        if (save === true) info('Overwriting draft named ' + resultPrompt);\n      }\n\n      if ( save === true ) {\n        var date = new Date();\n        date = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n\n        var html = dtfEditor.getContent();\n        var styles = dtfEditor.getUserStyles();\n\n        draftStore.saveDraft( resultPrompt, html, styles, blocks_config, date, checkingFunction);\n\n        function checkingFunction(val) {\n          if(val === true) {\n            dtfEditor.setMessage($.t('drafts.save_ok'), 'valid');\n          }\n          else {\n            dtfEditor.setMessage($.t('drafts.save_error'), 'error');\n          }\n        }\n      }\n    } else if ( resultPrompt === \"\" ) {\n      dtfEditor.setMessage($.t('drafts.name_empty'), 'error');\n    }\n    spinner('hide');\n  };\n\n  var hideMenu = function() {\n    $('#containerListDraft').removeClass('isActive');\n  };\n\n  var listDrafts = function() {\n    var draftsListUl = $('#listDraft');\n    draftsListUl.empty();\n\n    var list = draftStore.listDrafts();\n\n    list.forEach( function(draft) {\n\n      var draftLi = $(\"<li/>\");\n      draftLi.attr('data-objId', draft.id);\n\n      var spanDate = $('<span class=\"draftDate\">'+draft.date+'</span>');\n\n      var spanName = $('<span class=\"draftName\">'+draft.name+'</span>');\n\n      var spanDelete = $('<span class=\"spanDelete fa fa-minus-circle\"/>');\n\n\n      draftLi.append(spanDate);\n      draftLi.append(spanName);\n      draftLi.append(spanDelete);\n\n      draftLi.on('click', function(e) {\n        if ( confirm($.t('drafts.restore_confirm')) ) {\n          try {\n            draftStore.loadDraft(draft.id);\n          } catch(err) {\n            dtfEditor.setMessage($.t('drafts.restore_error'), 'error');\n          }\n        }\n      });\n\n      spanDelete.on('click', function(e) {\n        if(confirm($.t('drafts.delete_confirm'))) {\n          //var id = this.parentNode.getAttribute('data-objId');\n\n          draftStore.deleteDraft(draft.id, checkingFunction)\n\n          function checkingFunction(val) {\n            if(val === true) {\n              dtfEditor.setMessage($.t('drafts.delete_ok'), 'valid');\n            }\n            else {\n              dtfEditor.setMessage($.t('drafts.delete_error'), 'error');\n            }\n          }\n        }\n        e.stopPropagation();\n      });\n\n      draftsListUl.append(draftLi);\n    });\n  };\n\n  var deleteAllDrafts = function() {\n    var list = draftStore.listDrafts();\n    var draftsListUl = document.getElementById('listDraft');\n\n    for ( var v in list ) {\n      var id = this.parentNode.getAttribute('data-objId');\n      draftStore.deleteDraft(draft.id, checkingFunction)\n\n      function checkingFunction(val) {\n        if(val === true) {\n          draftsListUl.removeChild(draftLi);\n        }\n      }\n    }\n  };\n\n  return {\n    saveDraft       : saveDraft,\n    listDrafts      : listDrafts,\n    hideMenu        : hideMenu,\n    deleteAllDrafts : deleteAllDrafts\n  };\n\n})( jQuery );\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\n(function ( $ ) {\n  'use strict';\n\n  var instances;\n\n  $.fn.makeResizable = function () {\n    $.each(this, function(idx, el) {\n      var img = $(el);\n\n      var ratioResizable = Math.round(img[0].naturalHeight / img[0].naturalWidth);\n      var maxWidthResizable = img.closest('td').width();\n      var configResizable = {\n        maxWidth: maxWidthResizable,\n        minWidth: 50,\n        aspectRatio: true,\n        handles:\"e, s, se\"\n      };\n      if(img.data('resizable') === 'left') {\n        configResizable.handles = \"sw, w, s\";\n      }\n      img.resizable(configResizable);\n    });\n    return this;\n  };\n\n  $.fn.uploadify = function () {\n    $.each(this, function(idx, el) {\n      var uploadForm = $(window.templates.imageUploadForm);\n      var img = $(el);\n      var showFormButton = $(window.templates.imageUploadButton);\n      var attrHref;\n      var imgWidth = img.width();\n\n      uploadForm.i18n();\n\n      if(img.closest('a').length > 0) {\n        attrHref = img.parent('a').attr('href');\n        img.parent('a')\n        .removeAttr('href')\n        .attr('data-href', attrHref);\n      }\n\n      img.wrap('<div class=\"dtf-image-wrap\">');\n      img.parent().append(showFormButton);\n      img.parent().append(uploadForm.hide());\n      var waiter = uploadForm.find('.dtf-waiter');\n      var fileInput = uploadForm.find('input');\n      var browseBtn = uploadForm.find('.upload-button');\n      var closeLink = uploadForm.find('.button-cancel');\n\n      function showUploadForm() {\n        showFormButton.hide();\n        fileInput.show();\n        browseBtn.show();\n        waiter.hide();\n        uploadForm.show();\n      }\n\n      function hideUploadForm() {\n        uploadForm.hide();\n        showFormButton.show();\n        return false;\n      }\n\n      function startWaiting() {\n        fileInput.hide();\n        browseBtn.hide();\n        waiter.show();\n      }\n\n      showFormButton.click(showUploadForm);\n      closeLink.click(hideUploadForm);\n\n      fileInput.change(function() {\n        var fd = new FormData();\n        var file = uploadForm.find(\"#file\")[0].files[0];\n        fd.append(\"file\", file);\n        fd.append(\"width\", imgWidth);\n\n        var url = uploadStore.doUpload(fd);\n\n        if ( null !== url ) {\n          var dataResizable = (img.data('resizable') === undefined ? 'right' : img.data('resizable'));\n\n          if ( img.hasClass('dtf-resizable') ) {\n            img.resizable(\"destroy\");\n          }\n\n          var parent = img.parent();\n          var newImg = $('<img data-resizable=\"' + dataResizable + '\" class=\"dtf-resizable dtf-imageUploadable\" src=\"' + url + '\" width=\"' + img.width() + 'px\" />');\n          parent.replaceWith(newImg);\n\n          setTimeout(function(){\n            newImg.uploadify();\n            newImg.makeResizable();\n          }, 1000);\n        } else {\n          dtfEditor.setMessage($.t('upload.error'), 'error');\n        }\n\n        hideUploadForm();\n        startWaiting();\n        return false;\n      });\n    });\n    return this;\n  };\n\n}( jQuery ));\n","// Copyright (c) 2015 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfEditor = (function ( $ ) {\n  'use strict';\n\n  // Some scoped global variables\n  var undoBtn;\n\n  /**\n   * Blocks Catalog\n   */\n  var blocksCatalog = {\n    // DOM catalog\n    blocks  : $('<div>'),\n    // DOM content of each block, indexed by name as per configuration.json\n    doms    : {},\n    // blocks configs dictionnary\n    configs : {},\n\n    // Block icons library\n    icons   : {\n      'title'              : '<i class=\"icon-text\">T</i>',\n      'paragraph'          : '<i class=\"fa fa-2x fa-align-justify\"></i>',\n      'image'              : '<i class=\"fa fa-2x fa-picture-o\"></i>',\n      '1col_image_top'    : '<i class=\"fa fa-2x fa-picture-o\"></i><br /><i class=\"fa fa-2x fa fa-align-justify\"></i>',\n      '2cols_image_top'    : '<i class=\"fa fa-2x fa-picture-o\"></i><i class=\"fa fa-2x fa-picture-o\"></i><br /><i class=\"fa fa-2x fa fa-align-justify\"></i><i class=\"fa fa-2x fa fa-align-justify\"></i>',\n      '2cols_image_bottom' : '<i class=\"fa fa-2x fa fa-align-justify\"></i><i class=\"fa fa-2x fa fa-align-justify\"></i><br /><i class=\"fa fa-2x fa-picture-o\"></i><i class=\"fa fa-2x fa-picture-o\"></i>',\n      'quote'              : '<i class=\"icon-text icon-quote\">&rdquo;</i>',\n      'mixed_image_left'   : '<i class=\"fa fa-2x fa-picture-o\"></i><i class=\"fa fa-2x fa-align-justify\"></i>',\n      'mixed_image_right'  : '<i class=\"fa fa-2x fa-align-justify\"></i><i class=\"fa fa-2x fa-picture-o\"></i>',\n      'mixed_image_top'    : '<i class=\"fa fa-2x fa-picture-o\"></i><br /><i class=\"fa fa-2x fa-align-justify\"></i>',\n      'mixed_image_bottom' : '<i class=\"fa fa-2x fa-align-justify\"></i><br /><i class=\"fa fa-2x fa-picture-o\"></i>'\n    },\n\n    get_gallery: function () {\n      return this.blocks.children().clone(true, true);\n    },\n\n    get_dom: function ( name ) {\n      return this.doms[name].html.clone(true, true);\n    },\n\n    get_divClass: function ( name ) {\n      return this.doms[name].divClass;\n    },\n\n    add: function ( name, block_config, dom ) {\n      // To be able to call functions within this object\n      var that = this;\n\n      // Check if block is unique\n      if ( !block_config.isUnique ) {\n        var blockIcon = $('<span class=\"dtable icon\"><span class=\"dtable-cell\"></span></span>');\n        var blockCaption = $();\n\n        if (block_config.icon in this.icons) {\n          blockIcon.find('.dtable-cell').html(this.icons[block_config.icon]);\n          var caption = block_config.icon;\n          if ('caption' in block_config) caption = block_config.caption;\n          blockCaption = $('<span class=\"dblock\">' + caption + '</span>');\n        } else {\n          blockIcon = $(block_config.icon);\n        }\n        var link = $('<a class=\"dtf-block-choice\" href=\"#\">')\n              .attr('data-block-name', name)\n              .append(blockIcon);\n        if (blockCaption.length) {\n          link.append(blockCaption);\n        }\n\n        // Test changeable class in configuration.json\n        if ( typeof block_config.listChangeable === \"undefined\" ) {\n\n          $(block_config.selector).addClass('dtf-draggable');\n          this.blocks.first().append(link);\n\n        } else {\n\n          $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n          var existBlockDom = {\n            \"html\": $(block_config.selector).first().clone(true, true),\n            \"divClass\": $(block_config.selector).closest(\"div\").attr(\"class\")\n          };\n          dom = existBlockDom;\n          $(block_config.selector).addClass('dtf-draggable');\n          this.blocks.first().append(link);\n\n        }\n\n        //Duplicate exist DOM element and add to layout\n        link.on('click', function() {\n          var dom_block = that.get_dom($(this).attr('data-block-name'));\n          dom_block.addClass('dtf-draggable dtf-block');\n\n          var new_row = $(window.templates.baseBlock);\n          new_row.find('.dtf-block')\n            .replaceWith(dom_block);\n\n          var divClass = that.get_divClass($(this).attr('data-block-name'));\n\n          new_row.addClass(divClass);\n\n          var draft_row = $(this).closest('div.dtf-tr-element');\n          draft_row.after(new_row.css('display', 'none'));\n\n          if ( dom_block.hasClass('dtf-changeable') ) {\n            dtfLayoutMode.changeClass(dom_block);\n          } else {\n            dtfLayoutMode.equipBlock(dom_block);\n          }\n          new_row.show(100);\n\n          actionStack.push(function(){\n            dtfLayoutMode.deleteBlock(dom_block);\n          });\n\n          return false;\n        });\n\n      } else if ( block_config.isUnique && typeof block_config.listChangeable !== \"undefined\" ){\n\n        $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n        $(block_config.selector).addClass('isUnique');\n\n      } else {\n\n        $(block_config.selector).addClass('isUnique');\n\n      }\n      this.doms[name] = dom;\n      this.configs[name] = block_config;\n    }\n  };\n\n  /**\n   * Gets all the block config and initialize them\n   */\n  var _fetchBlocksConfig = function () {\n    _.forOwn(blocks_config.styles, function (config, name) {\n      var existBlockDom = {\n        \"html\": $(config.selector).first().clone(true, true),\n        \"divClass\": $(config.selector).closest(\"div\").attr(\"class\")\n      };\n      blocksCatalog.add(name, config, existBlockDom);\n\n      if ( config.urlckEditor !== undefined ) {\n        // Get CKEditor config URL from config\n        var ckEditorUrl = getAbsoluteUrl(config.urlckEditor);\n\n        // Fetch CKEditor config\n        $.getJSON(ckEditorUrl, function(data) {\n          // Set CKEditor language to global lang\n          data.ckEditor.language = settings.lang;\n\n          // Initialize the content editables in the block\n          $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor(data.ckEditor);\n          // Save the block config for future use\n          localStorage.setItem(config.selector,JSON.stringify(data.ckEditor));\n        });\n\n      } else {\n\n        // Initialize the content editables in the block with default config\n        $(config.selector).find('.dtf-contentEditable')\n        .attr('contentEditable', true)\n        .ckeditor({language: settings.lang});\n\n      }\n    });\n\n    dtfContentMode.enter();\n\n  };\n\n  /* Remove data attributes\n   */\n  var _removeDataAttributes = function ($target) {\n    if ( 0 !== $target.length ) {\n      var i,\n          attrName,\n          dataAttrsToDelete = [],\n          dataAttrs = $target.get(0).attributes,\n          dataAttrsLen = dataAttrs.length;\n\n      // Loop through attributes and make a list of those\n      // that begin with 'data-'\n      for (i=0; i<dataAttrsLen; i++) {\n          if ( 'data-' === dataAttrs[i].name.substring(0,5) ) {\n              // Why don't we just delete the attributes here?\n              // Deleting an attribute changes the indices of the\n              // others wreaking havoc on the loop we are inside\n              // b/c dataAttrs is a NamedNodeMap (not an array or obj)\n              dataAttrsToDelete.push(dataAttrs[i].name);\n          }\n      }\n      // Delete each of the attributes we found above\n      // i.e. those that start with \"data-\"\n      $.each( dataAttrsToDelete, function( index, attrName ) {\n          $target.removeAttr( attrName );\n      });\n    }\n  };\n\n  var _generateFinal = function ( html ) {\n    if ( undefined === html || null === html) {\n      error('No HTML provided, cannot generate final document');\n      setMessage($.t('editor.valid_error'), 'error');\n    } else {\n\n      spinner('show');\n      // Get the custom styles\n      var styles = getUserStyles();\n\n      // Load the boilerplate from the server\n      var boilerplateURL = settings.appRootUrl + 'final-boilerplate.html';\n      $.get(boilerplateURL, function (boilerplate) {\n        // Insert user bits\n        boilerplate = boilerplate.replace('[[USER_TITLE]]', settings.title);\n        boilerplate = boilerplate.replace('[[USER_STYLES]]', styles);\n        boilerplate = boilerplate.replace('[[USER_CONTENT]]', html);\n        boilerplate = boilerplate.replace('[[USER_NOINLINE_ATTR]]', settings.noinlineAttr);\n\n        // Remove CSS comments\n        boilerplate = boilerplate.replace(/\\/\\*(.|[\\r\\n])*?\\*\\//g, \"\");\n        // Remove blank lines for good measure\n        boilerplate = boilerplate.replace(/^\\s*[\\r\\n]/gm, \"\");\n\n        parent.postMessage(msgPrefix + boilerplate, \"*\");\n\n        spinner('hide');\n        setMessage($.t('editor.valid_ok'), 'valid', false);\n        // Lock the editor\n        _lockEdition(true);\n      })\n      .fail(function () {\n        warn('Could not get boilerplate from server, aborting content export');\n        spinner('hide');\n        setMessage($.t('editor.valid_error'), 'error');\n      });\n    }\n  };\n\n  var getUserStyles = function () {\n    // Get the styles\n    // we actually fetch all the content of <head> and remove unwanted bits\n    // to be able to keep parts wrapped in comments like <!--[if gte mso 9]>\n    var $head = $('head').clone();\n    $head.find('title,meta,link, script, style:not([data-userstyle])').remove();\n    _removeDataAttributes($head.find('style'));\n\n    return unescape($head.html());\n\n  };\n\n  String.prototype.htmlEncode = function() {\n    var charsToReplace = {\n      '“': '&ldquo;',\n      '”': '&rdquo;'\n    };\n    return this.replace(/[“”]/g, function(char) {\n        return charsToReplace[char] || char;\n    });\n  };\n\n  var getContent = function ( cleanup ) {\n    if ( undefined === cleanup) cleanup = false;\n\n    try {\n      // Disable the editor, removes the content editables and other stuff\n      dtfContentMode.leave();\n      // Clone the content div\n      var $content = $('#dtf-content').clone();\n\n      // Dump the raw html\n      var html = $content.html();\n\n      // Re-enable the editor\n      dtfContentMode.enter();\n\n      if (cleanup) {\n        // Do some more cleanup\n\n        // First get all the uploadable images sizes\n        // and set their attributes accordingly\n        $content.find('.dtf-imageUploadable').each(function() {\n          var width = $(this)[0].naturalWidth;\n          var height = $(this)[0].naturalHeight;\n          if ( $(this).width() !== 0 ) {\n            // Not a stock image, so get real size (possibly resized)\n            width = $(this).width();\n            height = $(this).height();\n          }\n          $(this).attr('width', width);\n          $(this).attr('height', height);\n          $(this).removeAttr('class style');\n        });\n\n\n        $content.find('.dtf-upload').remove();\n        _removeDataAttributes($content.find('.dtf-changeable'));\n        $content.find('.dtf-contentEditable').removeAttr('contenteditable style');\n        //Remove dentifrice Classes\n        $content.find('*[class*=\"dtf\"]').removeClass (function (index, css) {\n          return (css.match (/(^|\\s)dtf-\\S+/g) || []).join(' ');\n        });\n        $content.find('.isUnique').removeClass(\"isUnique\");\n\n        //Add table conditional IE\n        $content.find('#templateContainer td:first > div').each(function() {\n          $(this).before('<!--[if (gte mso 9)|(IE)]><table cellpadding=\"0\" cellspacing=\"0\" width=\"600\" align=\"center\"><tr><td><![endif]-->');\n          $(this).after('<!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->');\n        })\n        //Remove dtf Classes\n        html = html.replace(/dtf.* /g, \"\");\n      }\n\n      // HTML-encode some characters in the tags that might contain text,\n      // in order to avoid mangling further down the chain\n      // especially with UTF-8 encoding on POST (smart quotes for example)\n      html = html.htmlEncode();\n\n      // Remove no IE comments\n      html = html.replace(/<!--(?!\\[if).*?-->/g, \"\");\n\n      return html;\n\n    } catch(err) {\n      return null;\n    }\n  };\n\n  /**\n   * An action stack to allow undo-ing actions\n   */\n  var actionStack = {\n    stack : [],\n    // Push an undo function to the stack\n    push: function (func) {\n      this.stack.push(func);\n    },\n    // Calls the latest pushed function\n    undo: function() {\n      var last_el = this.stack.pop();\n      if (last_el) {\n        last_el();\n      } else {\n        info('nothing to undo');\n      }\n    },\n  };\n\n  /**\n   * A controller for an undo button based on an action stack\n   */\n  var UndoButton = function(el, stack) {\n    this.el = $(el);\n    this.stack = stack;\n\n    this.el.on('click', function(){\n      stack.undo();\n    });\n  };\n\n  UndoButton.prototype.flash = function(){\n    var btn = this.el;\n    var flash_color = 'rgb(202, 60, 60)';\n    var orig_color = btn.css('background-color');\n\n    btn.animate(\n      {backgroundColor: flash_color}, 100,\n      function() {\n        btn.animate({backgroundColor: orig_color}, 100);\n      }\n    );\n  };\n\n  var _lockEdition = function (lock) {\n    if (lock) {\n      $('.overlay').show();\n      $('#getList').hide();\n      $('#dtf-layout-mode').hide();\n      $('#dtf-drop-down-btn').hide();\n      $('#validateBtn').hide();\n      $('#resumeBtn').show();\n    } else {\n      $('#resumeBtn').hide();\n      $('#getList').show();\n      $('#dtf-layout-mode').show();\n      $('#dtf-drop-down-btn').show();\n      $('#validateBtn').show();\n      $('#messages').fadeOut(100);\n      $('.overlay').fadeOut(100);\n    }\n  };\n  /*\n  * add a item to dropdown\n  */\n  var addItemDropDown = function(btn, event) {\n    var li = $(\"<li/>\");\n    li.append(btn);\n    btn.on(\"click\", event);\n    $('#dtf-drop-down').append(li);\n  };\n\n  var _loadToolbar = function () {\n    if ( !$('#dtf-toolbar').length ) {\n      var toolbar = $(window.templates.layoutToolbar);\n      undoBtn = new UndoButton(toolbar.find('#undoBtn'), actionStack);\n\n      var layoutModeBtn = toolbar.find('#dtf-layout-mode');\n    \tlayoutModeBtn.on('click', function() {\n    \t\t$('#dtf-drop-down-btn').hide();\n        $('#validateBtn').hide();\n    \t\t$.proxy(dtfContentMode.leave,this)();\n    \t\t$.proxy(dtfLayoutMode.enter,this)();\n    \t});\n\n      var contentModeBtn  = toolbar.find('#dtf-content-mode');\n    \tcontentModeBtn.on('click', function() {\n    \t\t$('#dtf-drop-down-btn').show();\n        $('#validateBtn').show();\n    \t\t$.proxy(dtfLayoutMode.leave,this)();\n    \t\t// use setTimeout to let animation finish before we do heavy work\n    \t\t// otherwise, animation gets glitched.\n    \t\twindow.setTimeout(\n    \t\t\t$.proxy(dtfContentMode.enter,this),\n    \t\t\t100\n    \t\t);\n    \t});\n\n      var validateBtn = toolbar.find('#validateBtn');\n      validateBtn.on('click', function() {\n        // Generate final content and post to parent\n        _generateFinal(getContent(true));\n    \t});\n\n      var resumeBtn = toolbar.find('#resumeBtn');\n      resumeBtn.on('click', function() {\n        // We post an empty content to empty the parent textarea\n        // and force a new validation of the content\n        parent.postMessage(msgPrefix, \"*\");\n        // Unlock the editor\n        _lockEdition(false);\n    \t});\n\n      var containerListDraft = toolbar.find('#containerListDraft');\n\n      var saveDraftBtn = toolbar.find('#saveDraft');\n      saveDraftBtn.on('click', function() {\n    \t\tdtfDraftsManager.saveDraft();\n    \t});\n\n      var draftsListBtn = toolbar.find('#getList');\n    \tdraftsListBtn.on('click', function() {\n    \t\tdtfDraftsManager.listDrafts();\n        containerListDraft.addClass('isActive');\n        $('body').addClass('sidebarMenuOpen');\n    \t});\n\n      var closeDraftsListBtn = toolbar.find('#closeListDraft');\n    \tcloseDraftsListBtn.on('click', function() {\n    \t\tcontainerListDraft.removeClass('isActive');\n        $('body').removeClass('sidebarMenuOpen');\n    \t});\n\n      $('body').append(toolbar);\n\n      // Resume button needs to be hidden first\n      $('#resumeBtn').hide();\n\n      toolbar.i18n();\n\n      $('body').addClass('toolbarVisible');\n    }\n  };\n\n  /**\n   * Displays a notification on top of the editor\n   */\n  var setMessage = function ( text, status, temp ) {\n    if (undefined === temp) temp = true;\n\n    if ( !$('#messages').length ) {\n      $('body').append($(window.templates.layoutMessages));\n    }\n\n    $(\"#messages\").attr('class', '');\n    $('#messages')\n      .text(text)\n      .addClass(status)\n      .fadeIn(300);\n    if (temp) {\n      $('#messages')\n        .delay(2500)\n        .fadeOut(100);\n    }\n  };\n\n  var pushToStack = function ( fn ) {\n    actionStack.push(fn);\n  };\n\n  /**\n   * Load the editor\n   */\n  var load = function () {\n    _fetchBlocksConfig();\n    _loadToolbar();\n    _loadToolbar();\n  };\n\n\n\n  // Return public methods\n  return {\n    blocksCatalog   : blocksCatalog,\n    setMessage      : setMessage,\n    addItemDropDown : addItemDropDown,\n    pushToStack     : pushToStack,\n    getContent      : getContent,\n    getUserStyles   : getUserStyles,\n    load            : load\n  };\n\n}( jQuery ));\n"],"sourceRoot":"/source/"}