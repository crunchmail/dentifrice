/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
function error(t){output("error",t,!0)}function warn(t){output("warn",t,!0)}function info(t){output("info",t,settings.log)}function debug(t){output("log",t,settings.debug)}function output(t,e,n){!0===n&&"object"==typeof window.console&&console[t]("DentifriceEditor: "+e)}function loadSettings(t){var e={log:!0,debug:!1,showSpinner:!0,noinlineAttr:'inline="false"',uploadURL:"http://localhost:8080/files",plugins:{draftStore:"drafts-localstore.js",uploadStore:"upload-simplestore.js",beforeEditor:[],afterEditor:[]}};settings=_.merge(e,t),CKEDITOR_BASEPATH=settings.appRootUrl+"/ckeditor/"}function _init(t){t.appRootUrl=appRootUrl,t.lang=lang,t.title=title,loadSettings(t),dtfInit.loadEditor()}function _getQueryParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=e.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}var msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,appRootUrl,settings={},CKEDITOR_BASEPATH,getAbsoluteUrl=function(t){var e=new RegExp("^(?:[a-z]+:)?//","i");return e.test(t)?t:settings.appRootUrl+t.replace(/^\//,"")},spinner=function(t){var e=$(".overlay"),n=$(".spinner"),o=window.innerWidth/2-n.width()/2;if(n.css("left",o),settings.showSpinner)switch(t){case"show":debug("Showing spinner"),e.show(),n.show();break;case"hide":debug("Hiding spinner"),n.hide(),e.hide();break;default:warn("Unknown spinner action")}},blocks_config={styles:{}},dtfInit=function(t){"use strict";var e=function(n,o,i,r){"string"==typeof n&&(n=[n]),debug("Loading script: "+n[o]),t.getScript(n[o],function(){o+1<=n.length-1?e(n,o+1,i,r):i&&i()}).fail(function(t,e,i){warn(n[o]+" loading error: "+i),r&&r()})},n=function(){spinner("show");var n=[settings.appRootUrl+"js/plugins/"+settings.plugins.draftStore,settings.appRootUrl+"js/plugins/"+settings.plugins.uploadStore];"string"==typeof settings.plugins.beforeEditor&&(settings.plugins.beforeEditor=[settings.plugins.beforeEditor]);var o=settings.plugins.beforeEditor.map(function(t){return getAbsoluteUrl(t)});n=n.concat(o),n.push(settings.appRootUrl+"js/editor.js"),"string"==typeof settings.plugins.afterEditor&&(settings.plugins.afterEditor=[settings.plugins.afterEditor]);var i=settings.plugins.afterEditor.map(function(t){return getAbsoluteUrl(t)});n=n.concat(i),e(n,0,function(){info("Initializing locale"),t.i18n.init({lng:settings.lang,fallbackLng:"en",lowerCaseLng:!0,resGetPath:settings.appRootUrl+"locales/__lng__.json",useLocalStorage:!1,debug:settings.debug},function(){info("Initializing editor"),dtfEditor.load(),spinner("hide")})})};return{loadScripts:e,loadEditor:n}}(jQuery);!function(t){var e=location.href,n=e.substring(0,e.lastIndexOf("/")+1),o=n+"_local_settings.js",i=_getQueryParameterByName("template"),r=_getQueryParameterByName("styles"),s=_getQueryParameterByName("config");_getQueryParameterByName("lang"),_getQueryParameterByName("title");t("#dtf-content").load(i,function(e,n,i){"error"==n?error("Could not load template URL "+templateURL+": "+i.status+" "+i.statusText):(debug("Template loaded"),t.get(r,function(e){var n=t("<tmp/>").html(e);n.find("style").attr("data-userstyle",!0),n.contents().appendTo("head"),debug("Styles loaded"),t.getJSON(s,function(t){debug("Configuration loaded"),blocks_config=t,dtfInit.loadScripts(o,0,function(){_init(local_settings)},function(){var t={};_init(t)})}).fail(function(){error("Could not load configuration URL:"+configURL)})}).fail(function(){error("Could not load styles URL:"+stylesURL)}))})}(jQuery);
//# sourceMappingURL=init.min.js.map
