/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
var iframeID="dentifriceIframe",msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,lang="en",target,dentifrice_postMessage=function(){var e=function(){var e=window.addEventListener?"addEventListener":"attachEvent",t=window[e],n="attachEvent"==e?"onmessage":"message";t(n,dentifrice_postMessage_method.messageListener,!1)};return{setupMessageListener:e}}(),dentifrice_postMessage_method=function(){var e={final_html:function(e){return e.content}},t=function(e){for(var t=JSON.stringify(e),n=0;n<frames.length;n++)frames[n].hasOwnProperty("msgPrefix")&&frames[n].postMessage(msgPrefix+t,"*")},n=function(t){function n(){return msgPrefix===(""+i).substr(0,msgPrefixLen)}var i=t.data;if(i.length>msgPrefixLen&&"string"==typeof i&&n()){logger._debug("Received postmessage :"+i);var r=JSON.parse(i.substr(msgPrefixLen));e.hasOwnProperty(r.type)?target.value=e[r.type](r):logger._warn("Type undefined")}else logger._debug("Received postmessage, but not for us :"+i)};return{type:e,post:t,messageListener:n}}(),dentifrice=function(){"use strict";var e={},t={targetId:"dentifrice-textarea",templateUrl:null,stylesUrl:"styles.html",configUrl:"configuration.json",title:"Dentifrice Newsletter",lang:null,log:!0,debug:!1,hideTarget:!0,anchorId:null,replaceAnchor:!1,width:850,height:parseInt(.8*window.outerHeight)},n={en:{"Please validate":"Please validate your edition first !"},fr:{"Please validate":"Veuillez valider l'Ã©diteur !"}},i=function(){var t=navigator.language||navigator.userLanguage;e.lang&&e.lang in n?lang=e.lang:t in n&&(lang=t),logger._debug("Setting locale to: "+lang)},r=function(e){var t=n[lang];return e in t?t[e]:e},o=function(n){for(var i in t)t.hasOwnProperty(i)&&(e[i]=n.hasOwnProperty(i)?n[i]:t[i])},a=function(){var t=document.getElementById(e.targetId);return t&&0!==t.length?(logger._debug("Found element matching selector: "+e.targetId),t):(logger._warn("Could not find element with ID: "+e.targetId),!1)},s=function(){if(null===document.getElementById("dentifriceValidationAlert")){var t=document.getElementById(iframeID),n=document.createElement("div");n.id="dentifriceValidationAlert",n.textContent=r("Please validate"),t.parentNode.insertBefore(n,t);var i=t.getBoundingClientRect(),o=i.top+t.parentNode.scrollTop,a=n.offsetHeight,s=n.offsetWidth,g=parseFloat(o)-parseFloat(a)-4,l=parseFloat(e.width)-parseFloat(s);n.style.cssText="position: relative; top: -10px; left: "+l+"px; opacity: 1;",window.scrollTo(0,g-50),setTimeout(function(){null!==n.parentNode&&n.parentNode.removeChild(n)},2e3)}},g=function(e){logger._info("Initializing settings"),o(e),logger._info("Initializing locale"),i(),logger._info("Getting target element"),target=a(),logger._info("Setting up postMessages listener"),dentifrice_postMessage.setupMessageListener()};return{checkIfValidated:function(){return""===target.value?(s(),!1):!0},getSettings:function(){return e},init_dentifrice:g,bootstrap:function(t){return g(t),e.templateUrl?target?(logger._info("Initializing editor"),_initEditor.init(),!0):(logger._warn("Target element not found, aborting"),!1):(logger._warn("No template URL provided"),!1)}}}(),logger=function(e){var t=e.getSettings(),n=function(e,t,n){!0===n&&"object"==typeof window.console&&console[e]("Dentifrice: "+t)};return{_warn:function(e){n("warn",e,!0)},_info:function(e){n("info",e,t.log)},_debug:function(e){n("log",e,t.debug)}}}(dentifrice||{}),_initEditor=function(e){var t=function(){dentifrice_settings=e.getSettings(),dentifrice_settings.hideTarget&&(target.style.display="none");var t=dentifrice_settings.templateUrl.replace(/\/[^\/]*$/,"/"),n=/^https?:\/\/|^\/\//i,i=encodeURIComponent(dentifrice_settings.templateUrl),r=encodeURIComponent(t+dentifrice_settings.stylesUrl);n.test(dentifrice_settings.stylesUrl)&&(r=encodeURIComponent(dentifrice_settings.stylesUrl));var o=encodeURIComponent(t+dentifrice_settings.configUrl);n.test(dentifrice_settings.configUrl)&&(o=encodeURIComponent(dentifrice_settings.configUrl));var a="",s=document.getElementsByTagName("script"),g=/^(.*)dentifrice\.(min\.)*js$/;[].forEach.call(s,function(e){var t=e.getAttribute("src"),n=g.exec(t);n&&(a=n[1])});var l=a+"editor.html?template="+i+"&styles="+r+"&config="+o+"&lang="+lang+"&title="+dentifrice_settings.title,d=document.createElement("iframe");if(d.id=iframeID,d.setAttribute("src",l),d.style.border="0",d.style.width=dentifrice_settings.width+"px",d.style.height=dentifrice_settings.height+"px",dentifrice_settings.anchorId){var c=document.getElementById(dentifrice_settings.anchorId);0===c.length?logger._warn("Could not find anchor element with ID: "+dentifrice_settings.anchorId):(logger._debug("Found anchor element with ID: "+dentifrice_settings.anchorId),dentifrice_settings.replaceAnchor?(logger._debug("Replacing anchor element with editor"),c.parentNode.replaceChild(d,c)):(logger._debug("Inserting editor inside anchor element"),c.appendChild(d)))}else target.parentNode.insertBefore(d,target.nextSibling)};return{init:t}}(dentifrice||{});
//# sourceMappingURL=dentifrice.min.js.map
