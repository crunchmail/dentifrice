{"version":3,"sources":["content-mode.js","layout-mode.js","drafts-manager.js","uploadify.js","editor.js"],"names":["dtfContentMode","$","attrHref","enter","info","each","dtfEditor","blocksCatalog","configs","name","config","selector","data","remove","addClass","undefined","urlckEditor","confCkeditor","JSON","parse","localStorage","getItem","find","attr","ckeditor","addBack","filter","uploadify","closest","length","parent","removeAttr","makeResizable","is","show","contentLinks","debug","this","href","on","event","preventDefault","leave","CKEDITOR","instances","_","instance","destroy","removeClass","resizable","unwrap","jQuery","dtfLayoutMode","_draggable","block","parent_div","sortable","items","placeholder","revert","scrollSpeed","sort","ui","centerElement","height","item","topElement","offset","top","windowPos","parseFloat","window","scrollTop","start","css","scrollTo","stop","hasClass","changeClass","equipBlock","_addDelBtn","prev","templates","blockDelButton","insertBefore","element","next","row","before_row","row_parent","removed","deleteBlock","hide","pushToStack","after","prepend","_hide_catalog","_show_catalog","html","get_gallery","numberOfElement","i","draft_row","blockAddBar","fadeIn","blockClass","draft_rowAdd","blockChange","classesElement","removeOldClasse","split","join","arrClass","append","nameClass","deleted","add","clone","dtfDraftsManager","saveDraft","checkingSave","val","setMessage","t","spinner","resultPrompt","prompt","exist","save","draftStore","draftExists","confirm","date","Date","toLocaleDateString","toLocaleTimeString","getContent","styles","getUserStyles","blocks_config","hideMenu","listDrafts","checkingDelete","draftsListUl","empty","list","forEach","draft","draftLi","id","spanDate","spanName","spanDelete","e","loadDraft","err","deleteDraft","stopPropagation","deleteAllDrafts","checkingDeleteAll","removeChild","document","getElementById","v","parentNode","getAttribute","fn","idx","el","img","maxWidthResizable","Math","round","naturalHeight","naturalWidth","width","configResizable","maxWidth","minWidth","aspectRatio","handles","showUploadForm","showFormButton","fileInput","browseBtn","waiter","uploadForm","hideUploadForm","startWaiting","imageUploadForm","imageUploadButton","imgWidth","i18n","wrap","closeLink","click","change","fd","FormData","file","files","url","uploadStore","doUpload","dataResizable","newImg","replaceWith","setTimeout","undoBtn","blockEvent","last_el_created","insert","dom_block","get_dom","new_row","baseBlock","divClass","get_divClass","actionStack","push","blocks","doms","children","block_config","dom","isUnique","listChangeable","blockIcon","blockCaption","icon","blocksIcons","caption","link","first","existBlockDom","_fetchBlocksConfig","forOwn","cloned_block","ckEditorUrl","getAbsoluteUrl","getJSON","ckEditor","language","settings","lang","setItem","stringify","_removeDataAttributes","$target","dataAttrsToDelete","dataAttrs","get","attributes","dataAttrsLen","substring","index","attrName","_generateFinal","error","boilerplateURL","appRootUrl","boilerplate","replace","title","noinlineAttr","postMessage","post","_lockEdition","fail","warn","$head","unescape","String","prototype","htmlEncode","charsToReplace","“","”","char","cleanup","$content","match","before","stack","func","undo","last_el","pop","UndoButton","flash","btn","flash_color","orig_color","animate","backgroundColor","lock","fadeOut","addItemDropDown","li","_loadToolbar","toolbar","layoutToolbar","layoutModeBtn","proxy","contentModeBtn","validateBtn","resumeBtn","msgPrefix","containerListDraft","saveDraftBtn","draftsListBtn","closeDraftsListBtn","text","status","temp","layoutMessages","delay","load"],"mappings":"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","file":"editor.min.js","sourcesContent":["// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfContentMode = (function( $ ) {\n  'use strict';\n\n  var attrHref;\n\n  var enter = function() {\n    info('Entering ContentMode');\n\n    $.each(dtfEditor.blocksCatalog.configs, function(name, config) {\n      // Add CKEditor instances\n      if(!$(config.selector).data(\"default\")) {\n          $(config.selector).remove();\n      }\n      $(config.selector).addClass('dtf-block');\n      if(config.urlckEditor !== undefined) {\n        //get localStorage json file\n        var confCkeditor = JSON.parse(localStorage.getItem(config.selector));\n        $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor(confCkeditor);\n      }\n      else {\n        $(config.selector).find('.dtf-contentEditable')\n          .attr('contentEditable',true)\n          .ckeditor();\n      }\n\n      // Add controls around uploadable images\n      $(config.selector).find('*').addBack()\n        .filter('.dtf-imageUploadable')\n        .uploadify();\n\n      if($(config.selector).find('.dtf-imageUploadable').closest('a').length > 0) {\n\n        attrHref = $(config.selector).find('.dtf-imageUploadable').parent('a').attr('href');\n        $(config.selector)\n          .find('.dtf-imageUploadable').parent('a')\n          .removeAttr('href')\n          .attr('data-href', attrHref);\n      }\n\n      // Add controls for resizable images\n      $(config.selector).find('*').addBack()\n        .filter('.dtf-resizable')\n        .makeResizable();\n\n      if($('.ui-resizable-handle').is(':hidden')) {\n        $('.ui-resizable-handle').show();\n      }\n\n      // Disable click on all links outside content editables\n      var contentLinks = $('#dtf-content a:not(.cke_editable a)');\n      contentLinks.each(function () {\n        debug('Disabling clicks on link: ' + this.href);\n      });\n      contentLinks.on('click', function(event) {\n        event.preventDefault();\n      });\n    });\n  };\n\n  var leave = function() {\n    info('Leaving ContentMode');\n    // Remove content-editables\n    $.each(CKEDITOR.instances, function (_, instance) {\n      instance.destroy();\n    });\n    $('.dtf-contentEditable').attr('contentEditable', false);\n    $('.sortable-element').removeClass('sortable-element');\n\n    // Remove controls for resizable images\n    $('.dtf-resizable').resizable(\"destroy\");\n    // Remove controls uploadable image\n    $('.dtf-image-wrap').find(':not(.dtf-imageUploadable)').remove();\n    $('img.dtf-imageUploadable').unwrap();\n\n    if($('.dtf-imageUploadable').closest('a').length > 0) {\n      attrHref = $('.dtf-imageUploadable').parent('a').data('href');\n\n      $('.dtf-imageUploadable').parent('a')\n        .removeAttr('data-href')\n        .attr('href', attrHref);\n    }\n  };\n\n  return {\n    enter : enter,\n    leave : leave,\n  };\n\n})( jQuery );\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfLayoutMode = (function( $ ) {\n  'use strict';\n\n  var _draggable = function(block) {\n    var parent_div = block.closest('div'),\n      c = {};\n\n    parent_div.addClass('sortable-element');\n\n    $('#templateContainer').sortable({\n      items: '.sortable-element',\n      placeholder: \"ui-state-highlight\",\n      revert: true,\n      scrollSpeed: 40,\n      sort: function(event, ui) {\n        var containerHeight = $('#templateContainer').height()/2;\n        var centerElement = (ui.item.height()/2)/2;\n        var topElement = ui.item.offset().top/2;\n        var windowPos = parseFloat(topElement) + parseFloat(centerElement);\n        $(window).scrollTop(windowPos);\n      },\n      start: function(event, ui) {\n        ui.placeholder.height(ui.item.height());\n        $('.dtf-tr-element').remove();\n        $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 0.5);\n        var centerElement = (ui.item.height()/2);\n        var topElement = ui.item.offset().top;\n        var windowPos = parseFloat(topElement) + parseFloat(centerElement) - 100;\n        window.scrollTo(0, windowPos);\n      },\n      stop: function(event, ui) {\n        $('.button-del').remove();\n        $('.dtf-block').each(function() {\n          if($(this).hasClass('dtf-changeable')) {\n            changeClass($(this));\n          }else {\n            equipBlock($(this));\n          }\n        });\n        $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 1);\n      }\n    });\n  };\n\n  var _addDelBtn = function(block) {\n    if (block.prev('.pure-button-del').length <= 0 && !block.hasClass('isUnique')) {\n      $(window.templates.blockDelButton)\n        .insertBefore(block)\n        .on('click', function(){\n          var element = $(this).next();\n          var row = element.closest('tr');\n          var before_row = row.prev();\n          var row_parent = row.parent();\n          var next_draft = row.next('tr');\n          var removed = deleteBlock(element).hide();\n          dtfEditor.pushToStack(function(){\n            // Record previous element or parent if first\n            if (before_row.length > 0) {\n              before_row.after(removed);\n            } else {\n              row_parent.prepend(removed);\n            }\n            removed.show(200);\n          });\n        });\n    }\n  };\n\n  var _hide_catalog = function() {\n    $('.dtf-catalog').hide(100);\n    $('.dtf-add-bar .button-add:hidden').show(100);\n  };\n\n  var _show_catalog = function() {\n    _hide_catalog();\n    $(this).hide(100);\n\n    // show my catalog\n    $(this).closest('div').find('.dtf-catalog')\n      .html(dtfEditor.blocksCatalog.get_gallery())\n      .show(100);\n  };\n\n  var enter = function() {\n    info('Entering LayoutMode');\n\n    var numberOfElement = $('.dtf-block').length;\n    $('.dtf-block').each(function(i) {\n      //addClass lastClass to last element\n      if(i === numberOfElement - 1 ) $(this).addClass('lastChild');\n      if(!$(this).hasClass('dtf-changeable')) {\n        equipBlock($(this));\n        _draggable($('.dtf-draggable'));\n      }else {\n        changeClass($(this));\n      }\n    });\n\n    // Block adding\n    $('.first-hidden').show(100);\n    $(this).hide(100);\n  };\n\n  var leave = function() {\n    info('Leaving LayoutMode');\n\n    $('.dtf-draft-block').closest('div').remove();\n    $('.button-del').remove();\n    $('.first-hidden').hide(100);\n    $('#dtf-layout-mode').show(100);\n    $('.dtf-deletion-border').removeClass('dtf-deletion-border');\n    $( \"#templateContainer\" ).sortable( \"destroy\" );\n  };\n\n  /**\n   * Equips a block with a border and block inserting tool under it.\n   */\n  var equipBlock = function(block) {\n    var parent_div = block.closest('div');\n\n    block.addClass('dtf-deletion-border');\n    if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n      var draft_row = $(window.templates.blockAddBar);\n      draft_row.find('button').on('click', _show_catalog);\n      _hide_catalog();\n\n      parent_div.after(draft_row.fadeIn());\n    }\n\n    //Add button delete block if not Unique\n    _addDelBtn(block);\n\n  };\n\n  //Change Class of element with listChangeable in configuration.json\n  var changeClass = function(block, blockClass) {\n    var parent_div = block.closest('div');\n    //console.log(parent_div.find('.dtf-block'));\n\n    block.addClass('dtf-deletion-border');\n    if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n      if(!block.hasClass('lastChild')) {\n        var draft_rowAdd = $(window.templates.blockAddBar);\n\n        draft_rowAdd.find('button').on('click', _show_catalog);\n        _hide_catalog();\n\n        parent_div.after(draft_rowAdd.fadeIn());\n      }\n\n      var draft_row = $(window.templates.blockChange);\n      var classesElement = parent_div.find('.dtf-block').data('change-class');\n      var removeOldClasse = classesElement.split(',').join(' ');\n      var arrClass = classesElement.split(',');\n\n      parent_div.after(draft_row);\n\n      $.each(arrClass, function() {\n        if(block.closest('div').find('.dtf-block').hasClass(this)) {\n          draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"active dtf-background '+this+'\"></div>');\n\n        }else {\n          draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"dtf-background '+this+'\"></div>');\n        }\n\n      });\n\n      block.closest('div').next().on('click', '.dtf-background', function() {\n        $('.dtf-background').removeClass('active');\n        $(this).addClass('active');\n        draft_row.prev().find('.dtf-block').removeClass(removeOldClasse);\n        var nameClass = $(this).data('background');\n        draft_row.prev().find('.dtf-block').addClass(nameClass);\n\n      });\n    }\n\n    //Add button delete block if not Unique\n    _addDelBtn(block);\n  };\n\n  var deleteBlock = function (block) {\n    /* the setattr is a woraround to avoid getting a hidden forever\n     * cloned element\n     */\n    var parent_div = block.closest('div');\n    var deleted;\n    //console.log(parent_div.next('div'));\n    if(block.hasClass(\"dtf-changeable\")) {\n      deleted = $().add(parent_div).add(parent_div.next('div')).add(parent_div.next('div').next('div'));\n    }else {\n      deleted = $().add(parent_div).add(parent_div.next('div'));\n    }\n\n    var clone = deleted.clone(true, true);\n    deleted.hide(200, function() {\n      $(this).remove();\n    });\n    return clone;\n  };\n\n  return {\n    enter       : enter,\n    leave       : leave,\n    changeClass : changeClass,\n    equipBlock  : equipBlock,\n    deleteBlock : deleteBlock\n  };\n\n})( jQuery );\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfDraftsManager = (function( $ ) {\n  'use strict';\n\n  var versionTpl = 1;\n  var containerListDraft = $('containerListDraft');\n\n  var saveDraft = function() {\n    spinner('show');\n    var resultPrompt = prompt($.t('drafts.name_prompt'), $.t('drafts.default_name'));\n\n    function checkingSave(val) {\n      if(val === true) {\n        dtfEditor.setMessage($.t('drafts.save_ok'), 'valid');\n      }\n      else {\n        dtfEditor.setMessage($.t('drafts.save_error'), 'error');\n      }\n    }\n\n    if ( resultPrompt !== \"\" && resultPrompt !== null ) {\n      var save = true;\n      var exist;\n\n      if ( draftStore.draftExists(resultPrompt) ) {\n        info('Draft name already exist: ' + resultPrompt);\n        save = confirm($.t('drafts.overwrite_confirm'));\n        if (save === true) {\n          info('Overwriting draft named ' + resultPrompt);\n          exist = true;\n        }\n      }\n\n      if ( save === true ) {\n        var date = new Date();\n        date = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n\n        var html = dtfEditor.getContent();\n        var styles = dtfEditor.getUserStyles();\n\n        draftStore.saveDraft( resultPrompt, html, styles, blocks_config, date, checkingSave, exist);\n\n      }\n    } else if ( resultPrompt === \"\" ) {\n      dtfEditor.setMessage($.t('drafts.name_empty'), 'error');\n    }\n    spinner('hide');\n  };\n\n  var hideMenu = function() {\n    $('#containerListDraft').removeClass('isActive');\n  };\n\n  var listDrafts = function() {\n    var draftsListUl = $('#listDraft');\n    draftsListUl.empty();\n\n    var list = draftStore.listDrafts();\n\n    function checkingDelete(val) {\n      if(val === true) {\n        dtfEditor.setMessage($.t('drafts.delete_ok'), 'valid');\n      }\n      else {\n        dtfEditor.setMessage($.t('drafts.delete_error'), 'error');\n      }\n    }\n\n    list.forEach( function(draft) {\n\n      var draftLi = $(\"<li/>\");\n      draftLi.attr('data-objId', draft.id);\n\n      var spanDate = $('<span class=\"draftDate\">'+draft.date+'</span>');\n\n      var spanName = $('<span class=\"draftName\">'+draft.name+'</span>');\n\n      var spanDelete = $('<span class=\"spanDelete fa fa-minus-circle\"/>');\n\n\n      draftLi.append(spanDate);\n      draftLi.append(spanName);\n      draftLi.append(spanDelete);\n\n      draftLi.on('click', function(e) {\n        if ( confirm($.t('drafts.restore_confirm')) ) {\n          try {\n            draftStore.loadDraft(draft.id);\n          } catch(err) {\n            dtfEditor.setMessage($.t('drafts.restore_error'), 'error');\n          }\n        }\n      });\n\n      spanDelete.on('click', function(e) {\n        if(confirm($.t('drafts.delete_confirm'))) {\n          //var id = this.parentNode.getAttribute('data-objId');\n\n          draftStore.deleteDraft(draft.id, checkingDelete);\n\n        }\n        e.stopPropagation();\n      });\n\n      draftsListUl.append(draftLi);\n    });\n  };\n\n  var deleteAllDrafts = function() {\n    var list = draftStore.listDrafts();\n    var draftsListUl = document.getElementById('listDraft');\n\n    function checkingDeleteAll(val) {\n      if(val === true) {\n        draftsListUl.removeChild(draftLi);\n      }\n    }\n\n    for ( var v = 0; v < list.length; v++) {\n      var id = this.parentNode.getAttribute('data-objId');\n      draftStore.deleteDraft(draft.id, checkingDeleteAll);\n    }\n  };\n\n  return {\n    saveDraft       : saveDraft,\n    listDrafts      : listDrafts,\n    hideMenu        : hideMenu,\n    deleteAllDrafts : deleteAllDrafts\n  };\n\n})( jQuery );\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\n(function ( $ ) {\n  'use strict';\n\n  var instances;\n\n  $.fn.makeResizable = function () {\n    $.each(this, function(idx, el) {\n      var img = $(el);\n\n      var ratioResizable = Math.round(img[0].naturalHeight / img[0].naturalWidth);\n      var maxWidthResizable = img.closest('td').width();\n      var configResizable = {\n        maxWidth: maxWidthResizable,\n        minWidth: 50,\n        aspectRatio: true,\n        handles:\"e, s, se\"\n      };\n      if(img.data('resizable') === 'left') {\n        configResizable.handles = \"sw, w, s\";\n      }\n      img.resizable(configResizable);\n    });\n    return this;\n  };\n\n  $.fn.uploadify = function () {\n    $.each(this, function(idx, el) {\n      var uploadForm = $(window.templates.imageUploadForm);\n      var img = $(el);\n      var showFormButton = $(window.templates.imageUploadButton);\n      var attrHref;\n      var imgWidth = img.width();\n\n      uploadForm.i18n();\n\n      if(img.closest('a').length > 0) {\n        attrHref = img.parent('a').attr('href');\n        img.parent('a')\n        .removeAttr('href')\n        .attr('data-href', attrHref);\n      }\n\n      img.wrap('<div class=\"dtf-image-wrap\">');\n      img.parent().append(showFormButton);\n      img.parent().append(uploadForm.hide());\n      var waiter = uploadForm.find('.dtf-waiter');\n      var fileInput = uploadForm.find('input');\n      var browseBtn = uploadForm.find('.upload-button');\n      var closeLink = uploadForm.find('.button-cancel');\n\n      function showUploadForm() {\n        showFormButton.hide();\n        fileInput.show();\n        browseBtn.show();\n        waiter.hide();\n        uploadForm.show();\n      }\n\n      function hideUploadForm() {\n        uploadForm.hide();\n        showFormButton.show();\n        return false;\n      }\n\n      function startWaiting() {\n        fileInput.hide();\n        browseBtn.hide();\n        waiter.show();\n      }\n\n      showFormButton.click(showUploadForm);\n      closeLink.click(hideUploadForm);\n\n      fileInput.change(function() {\n        var fd = new FormData();\n        var file = uploadForm.find(\"#file\")[0].files[0];\n        fd.append(\"file\", file);\n        fd.append(\"width\", imgWidth);\n\n        var url = uploadStore.doUpload(fd);\n\n        if ( null !== url ) {\n          var dataResizable = (img.data('resizable') === undefined ? 'right' : img.data('resizable'));\n\n          if ( img.hasClass('dtf-resizable') ) {\n            img.resizable(\"destroy\");\n          }\n\n          var parent = img.parent();\n          var newImg = $('<img data-resizable=\"' + dataResizable + '\" class=\"dtf-resizable dtf-imageUploadable\" src=\"' + url + '\" width=\"' + img.width() + 'px\" />');\n          parent.replaceWith(newImg);\n\n          setTimeout(function(){\n            newImg.uploadify();\n            newImg.makeResizable();\n          }, 1000);\n        } else {\n          dtfEditor.setMessage($.t('upload.error'), 'error');\n        }\n\n        hideUploadForm();\n        startWaiting();\n        return false;\n      });\n    });\n    return this;\n  };\n\n}( jQuery ));\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfEditor = (function ( $ ) {\n    'use strict';\n\n    // Some scoped global variables\n    var undoBtn;\n\n    /*\n    * Blocks events\n    */\n    var blockEvent = {\n        last_el_created: null,\n        insert: function(el) {\n            var dom_block = blocksCatalog.get_dom(el.attr('data-block-name'));\n                dom_block.addClass('dtf-draggable dtf-block');\n\n            var new_row = $(window.templates.baseBlock);\n            new_row.find('.dtf-block')\n            .replaceWith(dom_block);\n\n            var divClass = blocksCatalog.get_divClass(el.attr('data-block-name'));\n\n            new_row.addClass(divClass);\n\n            var draft_row = el.closest('div.dtf-tr-element');\n            draft_row.after(new_row.css('display', 'none'));\n\n            if ( dom_block.hasClass('dtf-changeable') ) {\n                dtfLayoutMode.changeClass(dom_block);\n            } else {\n                dtfLayoutMode.equipBlock(dom_block);\n            }\n            blockEvent.last_el_created = new_row;\n            new_row.show(100);\n\n            actionStack.push(function(){\n                dtfLayoutMode.deleteBlock(dom_block);\n            });\n        }\n    };\n\n    /**\n    * Blocks Catalog\n    */\n    var blocksCatalog = {\n        // DOM catalog\n        blocks  : $('<div>'),\n        // DOM content of each block, indexed by name as per configuration.json\n        doms    : {},\n        // blocks configs dictionnary\n        configs : {},\n\n        get_gallery: function () {\n            return this.blocks.children().clone(true, true);\n        },\n\n        get_dom: function ( name ) {\n            return this.doms[name].html.clone(true, true);\n        },\n\n        get_divClass: function ( name ) {\n            return this.doms[name].divClass;\n        },\n\n        add: function ( name, block_config, dom ) {\n            // To be able to call functions within this object\n            var that = this;\n\n            // Check if block is unique\n            if ( !block_config.isUnique ) {\n                var blockIcon = $('<span class=\"dtable icon\"><span class=\"dtable-cell\"></span></span>');\n                var blockCaption = $();\n\n                if (block_config.icon in blocksIcons) {\n                    blockIcon.find('.dtable-cell').html(blocksIcons[block_config.icon]);\n                    var caption = block_config.icon;\n                    if ('caption' in block_config) caption = block_config.caption;\n                    blockCaption = $('<span class=\"dblock\">' + caption + '</span>');\n                } else {\n                    blockIcon = $(block_config.icon);\n                }\n                var link = $('<a class=\"dtf-block-choice\" href=\"#\">')\n                .attr('data-block-name', name)\n                .append(blockIcon);\n                if (blockCaption.length) {\n                    link.append(blockCaption);\n                }\n\n                // Test changeable class in configuration.json\n                if ( typeof block_config.listChangeable === \"undefined\" ) {\n\n                    $(block_config.selector).addClass('dtf-draggable');\n                    this.blocks.first().append(link);\n\n                } else {\n\n                    $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n                    var existBlockDom = {\n                        \"html\": $(block_config.selector).first().clone(true, true),\n                        \"divClass\": $(block_config.selector).closest(\"div\").attr(\"class\")\n                    };\n                    dom = existBlockDom;\n                    $(block_config.selector).addClass('dtf-draggable');\n                    this.blocks.first().append(link);\n\n                }\n\n                link.on(\"click\", function(e) {\n                    blockEvent.insert($(this));\n                    e.preventDefault();\n                });\n\n            } else if ( block_config.isUnique && typeof block_config.listChangeable !== \"undefined\" ){\n\n                $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n                $(block_config.selector).addClass('isUnique');\n\n            } else {\n\n                $(block_config.selector).addClass('isUnique');\n\n            }\n            this.doms[name] = dom;\n            this.configs[name] = block_config;\n        }\n    };\n\n    /**\n    * Gets all the block config and initialize them\n    */\n    var _fetchBlocksConfig = function () {\n        /*\n        * Reset blocksCatalog.blocks to prevent duplication\n        */\n        blocksCatalog.blocks = $('<div>');\n        _.forOwn(blocks_config.styles, function (config, name) {\n            var cloned_block = $(config.selector).first().clone(true, true);\n            cloned_block.attr(\"data-default\", \"true\");\n\n            var existBlockDom = {\n                \"html\": cloned_block,\n                \"divClass\": $(config.selector).closest(\"div\").attr(\"class\")\n            };\n            blocksCatalog.add(name, config, existBlockDom);\n\n            if ( config.urlckEditor !== undefined ) {\n                // Get CKEditor config URL from config\n                var ckEditorUrl = getAbsoluteUrl(config.urlckEditor);\n\n                // Fetch CKEditor config\n                $.getJSON(ckEditorUrl, function(data) {\n                    // Set CKEditor language to global lang\n                    data.ckEditor.language = settings.lang;\n\n                    // Initialize the content editables in the block\n                    $(config.selector).find('.dtf-contentEditable')\n                    .attr('contentEditable',true)\n                    .ckeditor(data.ckEditor);\n                    // Save the block config for future use\n                    localStorage.setItem(config.selector,JSON.stringify(data.ckEditor));\n                });\n\n            } else {\n\n                // Initialize the content editables in the block with default config\n                $(config.selector).find('.dtf-contentEditable')\n                .attr('contentEditable', true)\n                .ckeditor({language: settings.lang});\n\n            }\n        });\n\n        dtfContentMode.enter();\n\n    };\n\n    /* Remove data attributes\n    */\n    var _removeDataAttributes = function ($target) {\n        if ( 0 !== $target.length ) {\n            var i,\n            attrName,\n            dataAttrsToDelete = [],\n            dataAttrs = $target.get(0).attributes,\n            dataAttrsLen = dataAttrs.length;\n\n            // Loop through attributes and make a list of those\n            // that begin with 'data-'\n            for (i=0; i<dataAttrsLen; i++) {\n                if ( 'data-' === dataAttrs[i].name.substring(0,5) ) {\n                    // Why don't we just delete the attributes here?\n                    // Deleting an attribute changes the indices of the\n                    // others wreaking havoc on the loop we are inside\n                    // b/c dataAttrs is a NamedNodeMap (not an array or obj)\n                    dataAttrsToDelete.push(dataAttrs[i].name);\n                }\n            }\n            // Delete each of the attributes we found above\n            // i.e. those that start with \"data-\"\n            $.each( dataAttrsToDelete, function( index, attrName ) {\n                $target.removeAttr( attrName );\n            });\n        }\n    };\n\n    var _generateFinal = function ( html ) {\n        if ( undefined === html || null === html) {\n            error('No HTML provided, cannot generate final document');\n            setMessage($.t('editor.valid_error'), 'error');\n        } else {\n\n            spinner('show');\n            // Get the custom styles\n            var styles = getUserStyles();\n\n            // Load the boilerplate from the server\n            var boilerplateURL = settings.appRootUrl + 'final-boilerplate.html';\n            $.get(boilerplateURL, function (boilerplate) {\n                // Insert user bits\n                boilerplate = boilerplate.replace('[[USER_TITLE]]', settings.title);\n                boilerplate = boilerplate.replace('[[USER_STYLES]]', styles);\n                boilerplate = boilerplate.replace('[[USER_CONTENT]]', html);\n                boilerplate = boilerplate.replace('[[USER_NOINLINE_ATTR]]', settings.noinlineAttr);\n\n                // Remove CSS comments\n                boilerplate = boilerplate.replace(/\\/\\*(.|[\\r\\n])*?\\*\\//g, \"\");\n                // Remove blank lines for good measure\n                boilerplate = boilerplate.replace(/^\\s*[\\r\\n]/gm, \"\");\n\n                postMessage.post(\"final_html\", boilerplate);\n\n                spinner('hide');\n                setMessage($.t('editor.valid_ok'), 'valid', false);\n                // Lock the editor\n                _lockEdition(true);\n            })\n            .fail(function () {\n                warn('Could not get boilerplate from server, aborting content export');\n                spinner('hide');\n                setMessage($.t('editor.valid_error'), 'error');\n            });\n        }\n    };\n\n    var getUserStyles = function () {\n        // Get the styles\n        // we actually fetch all the content of <head> and remove unwanted bits\n        // to be able to keep parts wrapped in comments like <!--[if gte mso 9]>\n        var $head = $('head').clone();\n        $head.find('title,meta,link, script, style:not([data-userstyle])').remove();\n        _removeDataAttributes($head.find('style'));\n\n        return unescape($head.html());\n\n    };\n\n    String.prototype.htmlEncode = function() {\n        var charsToReplace = {\n            '“': '&ldquo;',\n            '”': '&rdquo;'\n        };\n        return this.replace(/[“”]/g, function(char) {\n            return charsToReplace[char] || char;\n        });\n    };\n\n    var getContent = function ( cleanup ) {\n        if ( undefined === cleanup) cleanup = false;\n\n        try {\n            // Disable the editor, removes the content editables and other stuff\n            dtfContentMode.leave();\n            // Clone the content div\n            var $content = $('#dtf-content').clone();\n\n            // Dump the raw html\n            var html = $content.html();\n\n            // Re-enable the editor\n            dtfContentMode.enter();\n\n            if (cleanup) {\n                // Do some more cleanup\n\n                // First get all the uploadable images sizes\n                // and set their attributes accordingly\n                $content.find('.dtf-imageUploadable').each(function() {\n                    var width = $(this)[0].naturalWidth;\n                    var height = $(this)[0].naturalHeight;\n                    if ( $(this).width() !== 0 ) {\n                        // Not a stock image, so get real size (possibly resized)\n                        width = $(this).width();\n                        height = $(this).height();\n                    }\n                    $(this).attr('width', width);\n                    $(this).attr('height', height);\n                    $(this).removeAttr('class style');\n                });\n\n\n                $content.find('.dtf-upload').remove();\n                _removeDataAttributes($content.find('.dtf-changeable'));\n                $content.find('.dtf-contentEditable').removeAttr('contenteditable style');\n                //Remove dentifrice Classes\n                $content.find('*[class*=\"dtf\"]').removeClass (function (index, css) {\n                    return (css.match (/dtf-[^\"'\\s]+(\\s)*/g) || []).join(' ');\n                });\n                $content.find('.isUnique').removeClass(\"isUnique\");\n\n                //Add table conditional IE\n                $content.find('#templateContainer td:first > div').each(function() {\n                    $(this).before('<!--[if (gte mso 9)|(IE)]><table cellpadding=\"0\" cellspacing=\"0\" width=\"600\" align=\"center\"><tr><td><![endif]-->');\n                    $(this).after('<!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->');\n                });\n            }\n\n            // HTML-encode some characters in the tags that might contain text,\n            // in order to avoid mangling further down the chain\n            // especially with UTF-8 encoding on POST (smart quotes for example)\n            html = html.htmlEncode();\n\n            // Remove no IE comments\n            html = html.replace(/<!--(?!\\[if).*?-->/g, \"\");\n\n            return html;\n\n        } catch(err) {\n            return null;\n        }\n    };\n\n    /**\n    * An action stack to allow undo-ing actions\n    */\n    var actionStack = {\n        stack : [],\n        // Push an undo function to the stack\n        push: function (func) {\n            this.stack.push(func);\n        },\n        // Calls the latest pushed function\n        undo: function() {\n            var last_el = this.stack.pop();\n            if (last_el) {\n                last_el();\n            } else {\n                info('nothing to undo');\n            }\n        },\n    };\n\n    /**\n    * A controller for an undo button based on an action stack\n    */\n    var UndoButton = function(el, stack) {\n        this.el = $(el);\n        this.stack = stack;\n\n        this.el.on('click', function(){\n            stack.undo();\n        });\n    };\n\n    UndoButton.prototype.flash = function(){\n        var btn = this.el;\n        var flash_color = 'rgb(202, 60, 60)';\n        var orig_color = btn.css('background-color');\n\n        btn.animate(\n            {backgroundColor: flash_color}, 100,\n            function() {\n                btn.animate({backgroundColor: orig_color}, 100);\n            }\n        );\n    };\n\n    var _lockEdition = function (lock) {\n        if (lock) {\n            $('.overlay').show();\n            $('#getList').hide();\n            $('#dtf-layout-mode').hide();\n            $('#dtf-drop-down-btn').hide();\n            $('#validateBtn').hide();\n            $('#resumeBtn').show();\n        } else {\n            $('#resumeBtn').hide();\n            $('#getList').show();\n            $('#dtf-layout-mode').show();\n            $('#dtf-drop-down-btn').show();\n            $('#validateBtn').show();\n            $('#messages').fadeOut(100);\n            $('.overlay').fadeOut(100);\n        }\n    };\n    /*\n    * add a item to dropdown\n    */\n    var addItemDropDown = function(btn, event) {\n        var li = $(\"<li/>\");\n        li.append(btn);\n        btn.on(\"click\", event);\n        $('#dtf-drop-down').append(li);\n    };\n\n    var _loadToolbar = function () {\n        if ( !$('#dtf-toolbar').length ) {\n            var toolbar = $(window.templates.layoutToolbar);\n            undoBtn = new UndoButton(toolbar.find('#undoBtn'), actionStack);\n\n            var layoutModeBtn = toolbar.find('#dtf-layout-mode');\n            layoutModeBtn.on('click', function() {\n                $('#dtf-drop-down-btn').hide();\n                $('#validateBtn').hide();\n                $.proxy(dtfContentMode.leave,this)();\n                $.proxy(dtfLayoutMode.enter,this)();\n            });\n\n            var contentModeBtn  = toolbar.find('#dtf-content-mode');\n            contentModeBtn.on('click', function() {\n                $('#dtf-drop-down-btn').show();\n                $('#validateBtn').show();\n                $.proxy(dtfLayoutMode.leave,this)();\n                // use setTimeout to let animation finish before we do heavy work\n                // otherwise, animation gets glitched.\n                window.setTimeout(\n                    $.proxy(dtfContentMode.enter,this),\n                    100\n                );\n            });\n\n            var validateBtn = toolbar.find('#validateBtn');\n            validateBtn.on('click', function() {\n                // Generate final content and post to parent\n                _generateFinal(getContent(true));\n            });\n\n            var resumeBtn = toolbar.find('#resumeBtn');\n            resumeBtn.on('click', function() {\n                // We post an empty content to empty the parent textarea\n                // and force a new validation of the content\n                parent.postMessage(msgPrefix, \"*\");\n                // Unlock the editor\n                _lockEdition(false);\n            });\n\n            var containerListDraft = toolbar.find('#containerListDraft');\n\n            var saveDraftBtn = toolbar.find('#saveDraft');\n            saveDraftBtn.on('click', function() {\n                dtfDraftsManager.saveDraft();\n            });\n\n            var draftsListBtn = toolbar.find('#getList');\n            draftsListBtn.on('click', function() {\n                dtfDraftsManager.listDrafts();\n                containerListDraft.addClass('isActive');\n                $('body').addClass('sidebarMenuOpen');\n            });\n\n            var closeDraftsListBtn = toolbar.find('#closeListDraft');\n            closeDraftsListBtn.on('click', function() {\n                containerListDraft.removeClass('isActive');\n                $('body').removeClass('sidebarMenuOpen');\n            });\n\n            $('body').append(toolbar);\n\n            // Resume button needs to be hidden first\n            $('#resumeBtn').hide();\n\n            toolbar.i18n();\n\n            $('body').addClass('toolbarVisible');\n        }\n    };\n\n    /**\n    * Displays a notification on top of the editor\n    */\n    var setMessage = function ( text, status, temp ) {\n        if (undefined === temp) temp = true;\n\n        if ( !$('#messages').length ) {\n            $('body').append($(window.templates.layoutMessages));\n        }\n\n        $(\"#messages\").attr('class', '');\n        $('#messages')\n        .text(text)\n        .addClass(status)\n        .fadeIn(300);\n        if (temp) {\n            $('#messages')\n            .delay(2500)\n            .fadeOut(100);\n        }\n    };\n\n    var pushToStack = function ( fn ) {\n        actionStack.push(fn);\n    };\n\n    /**\n    * Load the editor\n    */\n    var load = function () {\n        _fetchBlocksConfig();\n        _loadToolbar();\n        _loadToolbar();\n    };\n\n\n\n    // Return public methods\n    return {\n        blocksCatalog   : blocksCatalog,\n        blockEvent      : blockEvent,\n        setMessage      : setMessage,\n        addItemDropDown : addItemDropDown,\n        pushToStack     : pushToStack,\n        getContent      : getContent,\n        getUserStyles   : getUserStyles,\n        load            : load\n    };\n\n}( jQuery ));\n"],"sourceRoot":"/source/"}