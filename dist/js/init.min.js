/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
function error(t){output("error",t,!0)}function warn(t){output("warn",t,!0)}function info(t){output("info",t,settings.log)}function debug(t){output("log",t,settings.debug)}function output(t,n,e){!0===e&&"object"==typeof window.console&&console[t]("DentifriceEditor: "+n)}function loadSettings(t){var n={log:!0,debug:!1,showSpinner:!0,noinlineAttr:'inline="false"',uploadURL:"http://localhost:8080/files",plugins:{draftStore:"drafts-localstore.js",uploadStore:"upload-simplestore.js",beforeEditor:[],afterEditor:[]}};settings=_.merge(n,t),CKEDITOR_BASEPATH=settings.appRootUrl+"/ckeditor/"}var msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,settings={},CKEDITOR_BASEPATH,getAbsoluteUrl=function(t){var n=new RegExp("^(?:[a-z]+:)?//","i");return n.test(t)?t:settings.appRootUrl+t.replace(/^\//,"")},spinner=function(t){var n=$(".overlay"),e=$(".spinner"),o=window.innerWidth/2-e.width()/2;if(e.css("left",o),settings.showSpinner)switch(t){case"show":debug("Showing spinner"),n.show(),e.show();break;case"hide":debug("Hiding spinner"),e.hide(),n.hide();break;default:warn("Unknown spinner action")}},blocks_config={styles:{}},dtfInit=function(t){"use strict";var n=function(e,o,i,s){"string"==typeof e&&(e=[e]),debug("Loading script: "+e[o]),t.getScript(e[o],function(){o+1<=e.length-1?n(e,o+1,i,s):i&&i()}).fail(function(t,n,i){warn(e[o]+" loading error: "+i),s&&s()})},e=function(){spinner("show");var e=[settings.appRootUrl+"js/plugins/"+settings.plugins.draftStore,settings.appRootUrl+"js/plugins/"+settings.plugins.uploadStore];"string"==typeof settings.plugins.beforeEditor&&(settings.plugins.beforeEditor=[settings.plugins.beforeEditor]);var o=settings.plugins.beforeEditor.map(function(t){return getAbsoluteUrl(t)});e=e.concat(o),e.push(settings.appRootUrl+"js/editor.js"),"string"==typeof settings.plugins.afterEditor&&(settings.plugins.afterEditor=[settings.plugins.afterEditor]);var i=settings.plugins.afterEditor.map(function(t){return getAbsoluteUrl(t)});e=e.concat(i),n(e,0,function(){info("Initializing locale"),t.i18n.init({lng:settings.lang,fallbackLng:"en",lowerCaseLng:!0,resGetPath:settings.appRootUrl+"locales/__lng__.json",useLocalStorage:!1,debug:settings.debug},function(){info("Initializing editor"),dtfEditor.load(),spinner("hide")})})};return{loadScripts:n,loadEditor:e}}(jQuery);!function(t){function n(t){t.appRootUrl=i,t.lang=g,t.title=u,loadSettings(t),dtfInit.loadEditor()}function e(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)"),e=n.exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}var o=location.href,i=o.substring(0,o.lastIndexOf("/")+1),s=i+"_local_settings.js",r=e("template"),l=e("styles"),a=e("config"),g=e("lang"),u=e("title");t("#dtf-content").load(r,function(e,o,i){"error"==o?error("Could not load template URL "+templateURL+": "+i.status+" "+i.statusText):(debug("Template loaded"),t.get(l,function(e){var o=t("<tmp/>").html(e);o.find("style").attr("data-userstyle",!0),o.contents().appendTo("head"),debug("Styles loaded"),t.getJSON(a,function(t){debug("Configuration loaded"),blocks_config=t,dtfInit.loadScripts(s,0,function(){n(local_settings)},function(){var t={};n(t)})}).fail(function(){error("Could not load configuration URL:"+configURL)})}).fail(function(){error("Could not load styles URL:"+stylesURL)}))})}(jQuery);
//# sourceMappingURL=init.min.js.map
