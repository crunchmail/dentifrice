{"version":3,"sources":["content-mode.js","layout-mode.js","drafts-manager.js","uploadify.js","editor.js"],"names":["dtfContentMode","$","attrHref","enter","info","each","dtfEditor","blocksCatalog","configs","name","config","selector","data","remove","addClass","undefined","urlckEditor","confCkeditor","JSON","parse","localStorage","getItem","find","attr","ckeditor","addBack","filter","uploadify","closest","length","parent","removeAttr","makeResizable","is","show","contentLinks","debug","this","href","on","event","preventDefault","trigger","leave","CKEDITOR","instances","_","instance","destroy","removeClass","resizable","unwrap","jQuery","dtfLayoutMode","_draggable","block","parent_div","sortable","items","placeholder","revert","scrollSpeed","sort","ui","centerElement","height","item","topElement","offset","top","windowPos","parseFloat","window","scrollTop","start","css","scrollTo","stop","hasClass","changeClass","equipBlock","_addDelBtn","prev","templates","blockDelButton","insertBefore","element","next","row","before_row","row_parent","removed","deleteBlock","hide","pushToStack","after","prepend","_hide_catalog","_show_catalog","html","get_gallery","numberOfElement","i","draft_row","blockAddBar","fadeIn","blockClass","draft_rowAdd","blockChange","classesElement","removeOldClasse","split","join","arrClass","append","nameClass","deleted","add","clone","dtfDraftsManager","saveDraft","checkingSave","val","setMessage","t","spinner","resultPrompt","prompt","exist","save","draftStore","draftExists","confirm","date","Date","toLocaleDateString","toLocaleTimeString","getContent","styles","getUserStyles","blocks_config","hideMenu","listDrafts","checkingDelete","draftsListUl","empty","list","forEach","draft","draftLi","id","spanDate","spanName","spanDelete","e","loadDraft","err","deleteDraft","stopPropagation","deleteAllDrafts","checkingDeleteAll","removeChild","document","getElementById","v","parentNode","getAttribute","fn","idx","el","img","maxWidthResizable","Math","round","naturalHeight","naturalWidth","width","configResizable","maxWidth","minWidth","aspectRatio","handles","showUploadForm","showFormButton","fileInput","browseBtn","waiter","uploadForm","hideUploadForm","startWaiting","imageUploadForm","imageUploadButton","imgWidth","i18n","wrap","closeLink","click","change","fd","FormData","file","files","url","uploadStore","doUpload","dataResizable","newImg","replaceWith","setTimeout","undoBtn","blockEvent","last_el_created","insert","dom_block","get_dom","new_row","baseBlock","divClass","get_divClass","actionStack","push","blocks","doms","children","block_config","dom","isUnique","listChangeable","blockIcon","blockCaption","icon","blocksIcons","caption","link","first","existBlockDom","_fetchBlocksConfig","forOwn","cloned_block","ckEditorUrl","getAbsoluteUrl","getJSON","ckEditor","language","settings","lang","setItem","stringify","_removeDataAttributes","$target","dataAttrsToDelete","dataAttrs","get","attributes","dataAttrsLen","substring","index","attrName","generateFinal","$content","error","_contentCleanup","boilerplateURL","appRootUrl","boilerplate","replace","title","noinlineAttr","postMessage","post","_lockEdition","fail","warn","$head","unescape","String","prototype","htmlEncode","charsToReplace","“","”","char","asObject","htmlFromContent","dtfClass","match","before","stack","func","undo","last_el","pop","UndoButton","flash","btn","flash_color","orig_color","animate","backgroundColor","lock","fadeOut","addItemDropDown","li","_loadToolbar","toolbar","layoutToolbar","layoutModeBtn","proxy","contentModeBtn","validateBtn","resumeBtn","containerListDraft","saveDraftBtn","draftsListBtn","closeDraftsListBtn","text","status","temp","layoutMessages","delay","load","callback"],"mappings":"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","file":"editor.min.js","sourcesContent":["// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfContentMode = (function( $ ) {\n    'use strict';\n\n    var attrHref;\n\n    var enter = function() {\n        info('Entering ContentMode');\n\n        $.each(dtfEditor.blocksCatalog.configs, function(name, config) {\n            // Add CKEditor instances\n            if(!$(config.selector).data(\"default\")) {\n                $(config.selector).remove();\n            }\n            $(config.selector).addClass('dtf-block');\n            if(config.urlckEditor !== undefined) {\n                //get localStorage json file\n                var confCkeditor = JSON.parse(localStorage.getItem(config.selector));\n                $(config.selector).find('.dtf-contentEditable')\n                .attr('contentEditable',true)\n                .ckeditor(confCkeditor);\n            }\n            else {\n                $(config.selector).find('.dtf-contentEditable')\n                .attr('contentEditable',true)\n                .ckeditor();\n            }\n\n            // Add controls around uploadable images\n            $(config.selector).find('*').addBack()\n            .filter('.dtf-imageUploadable')\n            .uploadify();\n\n            if($(config.selector).find('.dtf-imageUploadable').closest('a').length > 0) {\n\n                attrHref = $(config.selector).find('.dtf-imageUploadable').parent('a').attr('href');\n                $(config.selector)\n                .find('.dtf-imageUploadable').parent('a')\n                .removeAttr('href')\n                .attr('data-href', attrHref);\n            }\n\n            // Add controls for resizable images\n            $(config.selector).find('*').addBack()\n            .filter('.dtf-resizable')\n            .makeResizable();\n\n            if($('.ui-resizable-handle').is(':hidden')) {\n                $('.ui-resizable-handle').show();\n            }\n\n            // Disable click on all links outside content editables\n            var contentLinks = $(config.selector).find('a:not(.cke_editable a)');\n            contentLinks.each(function () {\n                debug('Disabling clicks on link: ' + this.href);\n            });\n            contentLinks.on('click', function(event) {\n                event.preventDefault();\n            });\n        });\n\n        // Broadcast change mode event\n        debug('Broadcast dtfContentModeEnter');\n        $('#dtf-content').trigger('dtfContentModeEnter');\n    };\n\n    var leave = function() {\n        info('Leaving ContentMode');\n        // Remove content-editables\n        $.each(CKEDITOR.instances, function (_, instance) {\n            instance.destroy();\n        });\n        $('.dtf-contentEditable').attr('contentEditable', false);\n        $('.sortable-element').removeClass('sortable-element');\n\n        // Remove controls for resizable images\n        $('.dtf-resizable').resizable(\"destroy\");\n        // Remove controls uploadable image\n        $('.dtf-image-wrap').find(':not(.dtf-imageUploadable)').remove();\n        $('img.dtf-imageUploadable').unwrap();\n\n        if($('.dtf-imageUploadable').closest('a').length > 0) {\n            attrHref = $('.dtf-imageUploadable').parent('a').data('href');\n\n            $('.dtf-imageUploadable').parent('a')\n            .removeAttr('data-href')\n            .attr('href', attrHref);\n        }\n\n        // Broadcast change mode event\n        debug('Broadcast dtfContentModeLeave');\n        $('#dtf-content').trigger('dtfContentModeLeave');\n    };\n\n    return {\n        enter : enter,\n        leave : leave,\n    };\n\n})( jQuery );\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfLayoutMode = (function( $ ) {\n    'use strict';\n\n    var _draggable = function(block) {\n        var parent_div = block.closest('div'),\n        c = {};\n\n        parent_div.addClass('sortable-element');\n\n        $('#templateContainer').sortable({\n            items: '.sortable-element',\n            placeholder: \"ui-state-highlight\",\n            revert: true,\n            scrollSpeed: 40,\n            sort: function(event, ui) {\n                var containerHeight = $('#templateContainer').height()/2;\n                var centerElement = (ui.item.height()/2)/2;\n                var topElement = ui.item.offset().top/2;\n                var windowPos = parseFloat(topElement) + parseFloat(centerElement);\n                $(window).scrollTop(windowPos);\n            },\n            start: function(event, ui) {\n                ui.placeholder.height(ui.item.height());\n                $('.dtf-tr-element').remove();\n                $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 0.5);\n                var centerElement = (ui.item.height()/2);\n                var topElement = ui.item.offset().top;\n                var windowPos = parseFloat(topElement) + parseFloat(centerElement) - 100;\n                window.scrollTo(0, windowPos);\n            },\n            stop: function(event, ui) {\n                $('.button-del').remove();\n                $('.dtf-block').each(function() {\n                    if($(this).hasClass('dtf-changeable')) {\n                        changeClass($(this));\n                    }else {\n                        equipBlock($(this));\n                    }\n                });\n                $('#templateContainer > tbody > tr:not(.sortable-element)').css('opacity', 1);\n            }\n        });\n    };\n\n    var _addDelBtn = function(block) {\n        if (block.prev('.pure-button-del').length <= 0 && !block.hasClass('isUnique')) {\n            $(window.templates.blockDelButton)\n            .insertBefore(block)\n            .on('click', function(){\n                var element = $(this).next();\n                var row = element.closest('tr');\n                var before_row = row.prev();\n                var row_parent = row.parent();\n                var next_draft = row.next('tr');\n                var removed = deleteBlock(element).hide();\n                dtfEditor.pushToStack(function(){\n                    // Record previous element or parent if first\n                    if (before_row.length > 0) {\n                        before_row.after(removed);\n                    } else {\n                        row_parent.prepend(removed);\n                    }\n                    removed.show(200);\n                });\n            });\n        }\n    };\n\n    var _hide_catalog = function() {\n        $('.dtf-catalog').hide(100);\n        $('.dtf-add-bar .button-add:hidden').show(100);\n    };\n\n    var _show_catalog = function() {\n        _hide_catalog();\n        $(this).hide(100);\n\n        // show my catalog\n        $(this).closest('div').find('.dtf-catalog')\n        .html(dtfEditor.blocksCatalog.get_gallery())\n        .show(100);\n    };\n\n    var enter = function() {\n        info('Entering LayoutMode');\n\n        var numberOfElement = $('.dtf-block').length;\n        $('.dtf-block').each(function(i) {\n            //addClass lastClass to last element\n            if(i === numberOfElement - 1 ) $(this).addClass('lastChild');\n            if(!$(this).hasClass('dtf-changeable')) {\n                equipBlock($(this));\n                _draggable($('.dtf-draggable'));\n            }else {\n                changeClass($(this));\n            }\n        });\n\n        // Block adding\n        $('.first-hidden').show(100);\n        $(this).hide(100);\n\n        // Broadcast change mode event\n        debug('Broadcast dtfLayoutModeEnter');\n        $('#dtf-content').trigger('dtfLayoutModeEnter');\n    };\n\n    var leave = function() {\n        info('Leaving LayoutMode');\n\n        $('.dtf-draft-block').closest('div').remove();\n        $('.button-del').remove();\n        $('.first-hidden').hide(100);\n        $('#dtf-layout-mode').show(100);\n        $('.dtf-deletion-border').removeClass('dtf-deletion-border');\n        $( \"#templateContainer\" ).sortable( \"destroy\" );\n\n        // Broadcast change mode event\n        debug('Broadcast dtfLayoutModeLeave');\n        $('#dtf-content').trigger('dtfLayoutModeLeave');\n    };\n\n    /**\n    * Equips a block with a border and block inserting tool under it.\n    */\n    var equipBlock = function(block) {\n        var parent_div = block.closest('div');\n\n        block.addClass('dtf-deletion-border');\n        if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n            var draft_row = $(window.templates.blockAddBar);\n            draft_row.find('button').on('click', _show_catalog);\n            _hide_catalog();\n\n            parent_div.after(draft_row.fadeIn());\n        }\n\n        //Add button delete block if not Unique\n        _addDelBtn(block);\n\n    };\n\n    //Change Class of element with listChangeable in configuration.json\n    var changeClass = function(block, blockClass) {\n        var parent_div = block.closest('div');\n        //console.log(parent_div.find('.dtf-block'));\n\n        block.addClass('dtf-deletion-border');\n        if (parent_div.next('div').find('.dtf-draft-block').length <= 0) {\n            if(!block.hasClass('lastChild')) {\n                var draft_rowAdd = $(window.templates.blockAddBar);\n\n                draft_rowAdd.find('button').on('click', _show_catalog);\n                _hide_catalog();\n\n                parent_div.after(draft_rowAdd.fadeIn());\n            }\n\n            var draft_row = $(window.templates.blockChange);\n            var classesElement = parent_div.find('.dtf-block').data('change-class');\n            var removeOldClasse = classesElement.split(',').join(' ');\n            var arrClass = classesElement.split(',');\n\n            parent_div.after(draft_row);\n\n            $.each(arrClass, function() {\n                if(block.closest('div').find('.dtf-block').hasClass(this)) {\n                    draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"active dtf-background '+this+'\"></div>');\n\n                }else {\n                    draft_row.find('.dtf-change-element').append('<div data-background=\"'+this+'\" class=\"dtf-background '+this+'\"></div>');\n                }\n\n            });\n\n            block.closest('div').next().on('click', '.dtf-background', function() {\n                $('.dtf-background').removeClass('active');\n                $(this).addClass('active');\n                draft_row.prev().find('.dtf-block').removeClass(removeOldClasse);\n                var nameClass = $(this).data('background');\n                draft_row.prev().find('.dtf-block').addClass(nameClass);\n\n            });\n        }\n\n        //Add button delete block if not Unique\n        _addDelBtn(block);\n    };\n\n    var deleteBlock = function (block) {\n        /* the setattr is a woraround to avoid getting a hidden forever\n        * cloned element\n        */\n        var parent_div = block.closest('div');\n        var deleted;\n        //console.log(parent_div.next('div'));\n        if(block.hasClass(\"dtf-changeable\")) {\n            deleted = $().add(parent_div).add(parent_div.next('div')).add(parent_div.next('div').next('div'));\n        }else {\n            deleted = $().add(parent_div).add(parent_div.next('div'));\n        }\n\n        var clone = deleted.clone(true, true);\n        deleted.hide(200, function() {\n            $(this).remove();\n        });\n        return clone;\n    };\n\n    return {\n        enter       : enter,\n        leave       : leave,\n        changeClass : changeClass,\n        equipBlock  : equipBlock,\n        deleteBlock : deleteBlock\n    };\n\n})( jQuery );\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfDraftsManager = (function( $ ) {\n    'use strict';\n\n    var versionTpl = 1;\n    var containerListDraft = $('containerListDraft');\n\n    var saveDraft = function() {\n        spinner('show');\n        var resultPrompt = prompt($.t('drafts.name_prompt'), $.t('drafts.default_name'));\n\n        function checkingSave(val) {\n            if(val === true) {\n                dtfEditor.setMessage($.t('drafts.save_ok'), 'valid');\n            }\n            else {\n                dtfEditor.setMessage($.t('drafts.save_error'), 'error');\n            }\n        }\n\n        if ( resultPrompt !== \"\" && resultPrompt !== null ) {\n            var save = true;\n            var exist;\n\n            if ( draftStore.draftExists(resultPrompt) ) {\n                info('Draft name already exist: ' + resultPrompt);\n                save = confirm($.t('drafts.overwrite_confirm'));\n                if (save === true) {\n                    info('Overwriting draft named ' + resultPrompt);\n                    exist = true;\n                }\n            }\n\n            if ( save === true ) {\n                var date = new Date();\n                date = date.toLocaleDateString() + \" \" + date.toLocaleTimeString();\n\n                var html = dtfEditor.getContent();\n                var styles = dtfEditor.getUserStyles();\n\n                draftStore.saveDraft( resultPrompt, html, styles, blocks_config, date, checkingSave, exist);\n\n            }\n        } else if ( resultPrompt === \"\" ) {\n            dtfEditor.setMessage($.t('drafts.name_empty'), 'error');\n        }\n        spinner('hide');\n    };\n\n    var hideMenu = function() {\n        $('#containerListDraft').removeClass('isActive');\n    };\n\n    var listDrafts = function() {\n        var draftsListUl = $('#listDraft');\n        draftsListUl.empty();\n\n        var list = draftStore.listDrafts();\n\n        function checkingDelete(val) {\n            if(val === true) {\n                dtfEditor.setMessage($.t('drafts.delete_ok'), 'valid');\n            }\n            else {\n                dtfEditor.setMessage($.t('drafts.delete_error'), 'error');\n            }\n        }\n\n        list.forEach( function(draft) {\n\n            var draftLi = $(\"<li/>\");\n            draftLi.attr('data-objId', draft.id);\n            \n            var spanDate = $('<span class=\"draftDate\">'+draft.date+'</span>');\n\n            var spanName = $('<span class=\"draftName\">'+draft.name+'</span>');\n\n            var spanDelete = $('<span class=\"spanDelete fa fa-minus-circle\"/>');\n\n\n            draftLi.append(spanDate);\n            draftLi.append(spanName);\n            draftLi.append(spanDelete);\n\n            draftLi.on('click', function(e) {\n                if ( confirm($.t('drafts.restore_confirm')) ) {\n                    try {\n                        draftStore.loadDraft(draft.id);\n                    } catch(err) {\n                        dtfEditor.setMessage($.t('drafts.restore_error'), 'error');\n                    }\n                }\n            });\n\n            spanDelete.on('click', function(e) {\n                if(confirm($.t('drafts.delete_confirm'))) {\n                    //var id = this.parentNode.getAttribute('data-objId');\n\n                    draftStore.deleteDraft(draft.id, checkingDelete);\n\n                }\n                e.stopPropagation();\n            });\n\n            draftsListUl.append(draftLi);\n        });\n    };\n\n    var deleteAllDrafts = function() {\n        var list = draftStore.listDrafts();\n        var draftsListUl = document.getElementById('listDraft');\n\n        function checkingDeleteAll(val) {\n            if(val === true) {\n                draftsListUl.removeChild(draftLi);\n            }\n        }\n\n        for ( var v = 0; v < list.length; v++) {\n            var id = this.parentNode.getAttribute('data-objId');\n            draftStore.deleteDraft(draft.id, checkingDeleteAll);\n        }\n    };\n\n    return {\n        saveDraft       : saveDraft,\n        listDrafts      : listDrafts,\n        hideMenu        : hideMenu,\n        deleteAllDrafts : deleteAllDrafts\n    };\n\n})( jQuery );\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\n(function ( $ ) {\n    'use strict';\n\n    var instances;\n\n    $.fn.makeResizable = function () {\n        $.each(this, function(idx, el) {\n            var img = $(el);\n\n            var ratioResizable = Math.round(img[0].naturalHeight / img[0].naturalWidth);\n            var maxWidthResizable = img.closest('td').width();\n            var configResizable = {\n                maxWidth: maxWidthResizable,\n                minWidth: 50,\n                aspectRatio: true,\n                handles:\"e, s, se\"\n            };\n            if(img.data('resizable') === 'left') {\n                configResizable.handles = \"sw, w, s\";\n            }\n            img.resizable(configResizable);\n        });\n        return this;\n    };\n\n    $.fn.uploadify = function () {\n        $.each(this, function(idx, el) {\n            var uploadForm = $(window.templates.imageUploadForm);\n            var img = $(el);\n            var showFormButton = $(window.templates.imageUploadButton);\n            var attrHref;\n            var imgWidth = img.width();\n\n            uploadForm.i18n();\n\n            if(img.closest('a').length > 0) {\n                attrHref = img.parent('a').attr('href');\n                img.parent('a')\n                .removeAttr('href')\n                .attr('data-href', attrHref);\n            }\n\n            img.wrap('<div class=\"dtf-image-wrap\">');\n            img.parent().append(showFormButton);\n            img.parent().append(uploadForm.hide());\n            var waiter = uploadForm.find('.dtf-waiter');\n            var fileInput = uploadForm.find('input');\n            var browseBtn = uploadForm.find('.upload-button');\n            var closeLink = uploadForm.find('.button-cancel');\n\n            function showUploadForm() {\n                showFormButton.hide();\n                fileInput.show();\n                browseBtn.show();\n                waiter.hide();\n                uploadForm.show();\n            }\n\n            function hideUploadForm() {\n                uploadForm.hide();\n                showFormButton.show();\n                return false;\n            }\n\n            function startWaiting() {\n                fileInput.hide();\n                browseBtn.hide();\n                waiter.show();\n            }\n\n            showFormButton.click(showUploadForm);\n            closeLink.click(hideUploadForm);\n\n            fileInput.change(function() {\n                var fd = new FormData();\n                var file = uploadForm.find(\"#file\")[0].files[0];\n                fd.append(\"file\", file);\n                fd.append(\"width\", imgWidth);\n\n                var url = uploadStore.doUpload(fd);\n\n                if ( null !== url ) {\n                    var dataResizable = (img.data('resizable') === undefined ? 'right' : img.data('resizable'));\n\n                    if ( img.hasClass('dtf-resizable') ) {\n                        img.resizable(\"destroy\");\n                    }\n\n                    var parent = img.parent();\n                    var newImg = $('<img data-resizable=\"' + dataResizable + '\" class=\"dtf-resizable dtf-imageUploadable\" src=\"' + url + '\" width=\"' + img.width() + 'px\" />');\n                    parent.replaceWith(newImg);\n\n                    setTimeout(function(){\n                        newImg.uploadify();\n                        newImg.makeResizable();\n                    }, 1000);\n                } else {\n                    dtfEditor.setMessage($.t('upload.error'), 'error');\n                }\n\n                hideUploadForm();\n                startWaiting();\n                return false;\n            });\n        });\n        return this;\n    };\n\n}( jQuery ));\n","// Copyright (c) 2016 Oasiswork.\n// All Rights Reserved.\n//\n// This Source Code Form is subject to the\n// terms of the Mozilla Public License, v. 2.0.\n// If a copy of the MPL was not distributed with this file,\n// You can obtain one at\n// http://mozilla.org/MPL/2.0/.\n\nvar dtfEditor = (function ( $ ) {\n    'use strict';\n\n    // Some scoped global variables\n    var undoBtn;\n\n    /*\n    * Blocks events\n    */\n    var blockEvent = {\n        last_el_created: null,\n        insert: function(el) {\n            var dom_block = blocksCatalog.get_dom(el.attr('data-block-name'));\n            dom_block.addClass('dtf-draggable dtf-block');\n\n            var new_row = $(window.templates.baseBlock);\n            new_row.find('.dtf-block')\n            .replaceWith(dom_block);\n\n            var divClass = blocksCatalog.get_divClass(el.attr('data-block-name'));\n\n            new_row.addClass(divClass);\n\n            var draft_row = el.closest('div.dtf-tr-element');\n            draft_row.after(new_row.css('display', 'none'));\n\n            if ( dom_block.hasClass('dtf-changeable') ) {\n                dtfLayoutMode.changeClass(dom_block);\n            } else {\n                dtfLayoutMode.equipBlock(dom_block);\n            }\n            blockEvent.last_el_created = new_row;\n            new_row.show(100);\n\n            actionStack.push(function(){\n                dtfLayoutMode.deleteBlock(dom_block);\n            });\n        }\n    };\n\n    /**\n    * Blocks Catalog\n    */\n    var blocksCatalog = {\n        // DOM catalog\n        blocks  : $('<div>'),\n        // DOM content of each block, indexed by name as per configuration.json\n        doms    : {},\n        // blocks configs dictionnary\n        configs : {},\n\n        get_gallery: function () {\n            return this.blocks.children().clone(true, true);\n        },\n\n        get_dom: function ( name ) {\n            return this.doms[name].html.clone(true, true);\n        },\n\n        get_divClass: function ( name ) {\n            return this.doms[name].divClass;\n        },\n\n        add: function ( name, block_config, dom ) {\n            // To be able to call functions within this object\n            var that = this;\n\n            // Check if block is unique\n            if ( !block_config.isUnique ) {\n                var blockIcon = $('<span class=\"dtable icon\"><span class=\"dtable-cell\"></span></span>');\n                var blockCaption = $();\n\n                if (block_config.icon in blocksIcons) {\n                    blockIcon.find('.dtable-cell').html(blocksIcons[block_config.icon]);\n                    var caption = block_config.icon;\n                    if ('caption' in block_config) caption = block_config.caption;\n                    blockCaption = $('<span class=\"dblock\">' + caption + '</span>');\n                } else {\n                    blockIcon = $(block_config.icon);\n                }\n                var link = $('<a class=\"dtf-block-choice\" href=\"#\">')\n                .attr('data-block-name', name)\n                .append(blockIcon);\n                if (blockCaption.length) {\n                    link.append(blockCaption);\n                }\n\n                // Test changeable class in configuration.json\n                if ( typeof block_config.listChangeable === \"undefined\" ) {\n\n                    $(block_config.selector).addClass('dtf-draggable');\n                    this.blocks.first().append(link);\n\n                } else {\n\n                    $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n                    var existBlockDom = {\n                        \"html\": $(block_config.selector).first().clone(true, true),\n                        \"divClass\": $(block_config.selector).closest(\"div\").attr(\"class\")\n                    };\n                    dom = existBlockDom;\n                    $(block_config.selector).addClass('dtf-draggable');\n                    this.blocks.first().append(link);\n\n                }\n\n                link.on(\"click\", function(e) {\n                    blockEvent.insert($(this));\n                    e.preventDefault();\n                });\n\n            } else if ( block_config.isUnique && typeof block_config.listChangeable !== \"undefined\" ){\n\n                $(block_config.selector).attr('data-change-class', block_config.listChangeable);\n                $(block_config.selector).addClass('isUnique');\n\n            } else {\n\n                $(block_config.selector).addClass('isUnique');\n\n            }\n            this.doms[name] = dom;\n            this.configs[name] = block_config;\n        }\n    };\n\n    /**\n    * Gets all the block config and initialize them\n    */\n    var _fetchBlocksConfig = function () {\n        /*\n        * Reset blocksCatalog.blocks to prevent duplication\n        */\n        blocksCatalog.blocks = $('<div>');\n        _.forOwn(blocks_config.styles, function (config, name) {\n            var cloned_block = $(config.selector).first().clone(true, true);\n            cloned_block.attr(\"data-default\", \"true\");\n\n            var existBlockDom = {\n                \"html\": cloned_block,\n                \"divClass\": $(config.selector).closest(\"div\").attr(\"class\")\n            };\n            blocksCatalog.add(name, config, existBlockDom);\n\n            if ( config.urlckEditor !== undefined ) {\n                // Get CKEditor config URL from config\n                var ckEditorUrl = getAbsoluteUrl(config.urlckEditor);\n\n                // Fetch CKEditor config\n                $.getJSON(ckEditorUrl, function(data) {\n                    // Set CKEditor language to global lang\n                    data.ckEditor.language = settings.lang;\n\n                    // Initialize the content editables in the block\n                    $(config.selector).find('.dtf-contentEditable')\n                    .attr('contentEditable',true)\n                    .ckeditor(data.ckEditor);\n                    // Save the block config for future use\n                    localStorage.setItem(config.selector,JSON.stringify(data.ckEditor));\n                });\n\n            } else {\n\n                // Initialize the content editables in the block with default config\n                $(config.selector).find('.dtf-contentEditable')\n                .attr('contentEditable', true)\n                .ckeditor({language: settings.lang});\n\n            }\n        });\n\n        dtfContentMode.enter();\n\n    };\n\n    /* Remove data attributes\n    */\n    var _removeDataAttributes = function ($target) {\n        if ( 0 !== $target.length ) {\n            var i,\n            attrName,\n            dataAttrsToDelete = [],\n            dataAttrs = $target.get(0).attributes,\n            dataAttrsLen = dataAttrs.length;\n\n            // Loop through attributes and make a list of those\n            // that begin with 'data-'\n            for (i=0; i<dataAttrsLen; i++) {\n                if ( 'data-' === dataAttrs[i].name.substring(0,5) ) {\n                    // Why don't we just delete the attributes here?\n                    // Deleting an attribute changes the indices of the\n                    // others wreaking havoc on the loop we are inside\n                    // b/c dataAttrs is a NamedNodeMap (not an array or obj)\n                    dataAttrsToDelete.push(dataAttrs[i].name);\n                }\n            }\n            // Delete each of the attributes we found above\n            // i.e. those that start with \"data-\"\n            $.each( dataAttrsToDelete, function( index, attrName ) {\n                $target.removeAttr( attrName );\n            });\n        }\n    };\n\n    var generateFinal = function ( $content ) {\n        if ( undefined === $content || null === $content) {\n            error('No HTML content provided, cannot generate final document');\n            setMessage($.t('editor.valid_error'), 'error');\n        } else {\n\n            spinner('show');\n            var html = _contentCleanup($content);\n            // Get the custom styles\n            var styles = getUserStyles();\n\n            // Load the boilerplate from the server\n            var boilerplateURL = settings.appRootUrl + 'final-boilerplate.html';\n            $.get(boilerplateURL, function (boilerplate) {\n                // Insert user bits\n                boilerplate = boilerplate.replace('[[USER_TITLE]]', settings.title);\n                boilerplate = boilerplate.replace('[[USER_STYLES]]', styles);\n                boilerplate = boilerplate.replace('[[USER_CONTENT]]', html);\n                boilerplate = boilerplate.replace('[[USER_NOINLINE_ATTR]]', settings.noinlineAttr);\n\n                // Remove CSS comments\n                boilerplate = boilerplate.replace(/\\/\\*(.|[\\r\\n])*?\\*\\//g, \"\");\n                // Remove blank lines for good measure\n                boilerplate = boilerplate.replace(/^\\s*[\\r\\n]/gm, \"\");\n\n                postMessage.post(\"final_html\", boilerplate);\n\n                spinner('hide');\n                setMessage($.t('editor.valid_ok'), 'valid', false);\n                // Lock the editor\n                _lockEdition(true);\n            })\n            .fail(function () {\n                warn('Could not get boilerplate from server, aborting content export');\n                spinner('hide');\n                setMessage($.t('editor.valid_error'), 'error');\n            });\n        }\n    };\n\n    var getUserStyles = function () {\n        // Get the styles\n        // we actually fetch all the content of <head> and remove unwanted bits\n        // to be able to keep parts wrapped in comments like <!--[if gte mso 9]>\n        var $head = $('head').clone();\n        $head.find('title,meta,link, script, style:not([data-userstyle])').remove();\n        _removeDataAttributes($head.find('style'));\n\n        return unescape($head.html());\n\n    };\n\n    String.prototype.htmlEncode = function() {\n        var charsToReplace = {\n            '“': '&ldquo;',\n            '”': '&rdquo;'\n        };\n        return this.replace(/[“”]/g, function(char) {\n            return charsToReplace[char] || char;\n        });\n    };\n\n    var getContent = function ( asObject ) {\n        if ( undefined === asObject) asObject = false;\n\n        try {\n            // Disable the editor, removes the content editables and other stuff\n            dtfContentMode.leave();\n            // Clone the content div\n            var $content = $('#dtf-content').clone();\n\n            // Re-enable the editor\n            dtfContentMode.enter();\n\n            if (asObject) {\n                return $content;\n            } else {\n                return htmlFromContent($content);\n            }\n\n        } catch(err) {\n            error('Error getting content !');\n            return null;\n        }\n    };\n\n    var htmlFromContent = function( $content ) {\n        // Remove internal classes\n        _.each(['dtf-block', 'dtf-draggable', 'isUnique'], function(dtfClass) {\n            $content.find('.'+dtfClass).removeClass(dtfClass);\n        });\n\n        // Dump the raw html\n        var html = $content.html();\n\n        // HTML-encode some characters in the tags that might contain text,\n        // in order to avoid mangling further down the chain\n        // especially with UTF-8 encoding on POST (smart quotes for example)\n        html = html.htmlEncode();\n\n        // Remove tbody tags\n        html = html.replace(/<\\/?tbody>/g, '');\n\n        // Remove no IE comments\n        html = html.replace(/<!--(?!\\[if).*?-->/g, \"\");\n\n        return html;\n    };\n\n    var _contentCleanup = function($content) {\n        // First get all the uploadable images sizes\n        // and set their attributes accordingly\n        $content.find('.dtf-imageUploadable').each(function() {\n            var width = $(this)[0].naturalWidth;\n            var height = $(this)[0].naturalHeight;\n            if ( $(this).width() !== 0 ) {\n                // Not a stock image, so get real size (possibly resized)\n                width = $(this).width();\n                height = $(this).height();\n            }\n            $(this).attr('width', width);\n            $(this).attr('height', height);\n            $(this).removeAttr('class style');\n        });\n\n\n        $content.find('.dtf-upload').remove();\n        _removeDataAttributes($content.find('.dtf-changeable'));\n        $content.find('.dtf-contentEditable').removeAttr('contenteditable style');\n        //Remove dentifrice Classes\n        $content.find('*[class*=\"dtf\"]').removeClass (function (index, css) {\n            return (css.match(/dtf-[^\"'\\s]+(\\s)*/g) || []).join(' ');\n        });\n        $content.find('.isUnique').removeClass(\"isUnique\");\n\n        //Add table conditional IE\n        $content.find('#templateContainer td:first > div').each(function() {\n            $(this).before('<!--[if (gte mso 9)|(IE)]><table cellpadding=\"0\" cellspacing=\"0\" width=\"600\" align=\"center\"><tr><td><![endif]-->');\n            $(this).after('<!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->');\n        });\n\n        return htmlFromContent($content);\n    };\n\n    /**\n    * An action stack to allow undo-ing actions\n    */\n    var actionStack = {\n        stack : [],\n        // Push an undo function to the stack\n        push: function (func) {\n            this.stack.push(func);\n        },\n        // Calls the latest pushed function\n        undo: function() {\n            var last_el = this.stack.pop();\n            if (last_el) {\n                last_el();\n            } else {\n                info('nothing to undo');\n            }\n        },\n    };\n\n    /**\n    * A controller for an undo button based on an action stack\n    */\n    var UndoButton = function(el, stack) {\n        this.el = $(el);\n        this.stack = stack;\n\n        this.el.on('click', function(){\n            stack.undo();\n        });\n    };\n\n    UndoButton.prototype.flash = function(){\n        var btn = this.el;\n        var flash_color = 'rgb(202, 60, 60)';\n        var orig_color = btn.css('background-color');\n\n        btn.animate(\n            {backgroundColor: flash_color}, 100,\n            function() {\n                btn.animate({backgroundColor: orig_color}, 100);\n            }\n        );\n    };\n\n    var _lockEdition = function (lock) {\n        if (lock) {\n            $('.overlay').show();\n            $('#getList').hide();\n            $('#dtf-layout-mode').hide();\n            $('#dtf-drop-down-btn').hide();\n            $('#validateBtn').hide();\n            $('#resumeBtn').show();\n        } else {\n            $('#resumeBtn').hide();\n            $('#getList').show();\n            $('#dtf-layout-mode').show();\n            $('#dtf-drop-down-btn').show();\n            $('#validateBtn').show();\n            $('#messages').fadeOut(100);\n            $('.overlay').fadeOut(100);\n        }\n    };\n    /*\n    * add a item to dropdown\n    */\n    var addItemDropDown = function(btn, event) {\n        var li = $(\"<li/>\");\n        li.append(btn);\n        btn.on(\"click\", event);\n        $('#dtf-drop-down').append(li);\n    };\n\n    var _loadToolbar = function () {\n        if ( !$('#dtf-toolbar').length ) {\n            var toolbar = $(window.templates.layoutToolbar);\n            undoBtn = new UndoButton(toolbar.find('#undoBtn'), actionStack);\n\n            var layoutModeBtn = toolbar.find('#dtf-layout-mode');\n            layoutModeBtn.on('click', function() {\n                $('#dtf-drop-down-btn').hide();\n                $('#validateBtn').hide();\n                $.proxy(dtfContentMode.leave,this)();\n                $.proxy(dtfLayoutMode.enter,this)();\n            });\n\n            var contentModeBtn  = toolbar.find('#dtf-content-mode');\n            contentModeBtn.on('click', function() {\n                $('#dtf-drop-down-btn').show();\n                $('#validateBtn').show();\n                $.proxy(dtfLayoutMode.leave,this)();\n                // use setTimeout to let animation finish before we do heavy work\n                // otherwise, animation gets glitched.\n                window.setTimeout(\n                    $.proxy(dtfContentMode.enter,this),\n                    100\n                );\n            });\n\n            var validateBtn = toolbar.find('#validateBtn');\n            validateBtn.on('click', function() {\n                // Generate final content and post to parent\n                generateFinal(getContent(true));\n            });\n\n            var resumeBtn = toolbar.find('#resumeBtn');\n            resumeBtn.on('click', function() {\n                // We post an empty content to empty the parent textarea\n                // and force a new validation of the content\n                postMessage.post(\"final_html\", \"\");\n                // Unlock the editor\n                _lockEdition(false);\n            });\n\n            var containerListDraft = toolbar.find('#containerListDraft');\n\n            var saveDraftBtn = toolbar.find('#saveDraft');\n            saveDraftBtn.on('click', function() {\n                dtfDraftsManager.saveDraft();\n            });\n\n            var draftsListBtn = toolbar.find('#getList');\n            draftsListBtn.on('click', function() {\n                dtfDraftsManager.listDrafts();\n                containerListDraft.addClass('isActive');\n                $('body').addClass('sidebarMenuOpen');\n            });\n\n            var closeDraftsListBtn = toolbar.find('#closeListDraft');\n            closeDraftsListBtn.on('click', function() {\n                containerListDraft.removeClass('isActive');\n                $('body').removeClass('sidebarMenuOpen');\n            });\n\n            $('body').append(toolbar);\n\n            // Resume button needs to be hidden first\n            $('#resumeBtn').hide();\n\n            toolbar.i18n();\n\n            $('body').addClass('toolbarVisible');\n        }\n    };\n\n    /**\n    * Displays a notification on top of the editor\n    */\n    var setMessage = function ( text, status, temp ) {\n        if (undefined === temp) temp = true;\n\n        if ( !$('#messages').length ) {\n            $('body').append($(window.templates.layoutMessages));\n        }\n\n        $(\"#messages\").attr('class', '');\n        $('#messages')\n        .text(text)\n        .addClass(status)\n        .fadeIn(300);\n        if (temp) {\n            $('#messages')\n            .delay(2500)\n            .fadeOut(100);\n        }\n    };\n\n    var pushToStack = function ( fn ) {\n        actionStack.push(fn);\n    };\n\n    /**\n    * Load the editor\n    */\n    var load = function (callback) {\n        _fetchBlocksConfig();\n        _loadToolbar();\n        if (callback) {\n            debug('calling after-load callback');\n            callback();\n        }\n    };\n\n\n\n    // Return public methods\n    return {\n        blocksCatalog   : blocksCatalog,\n        blockEvent      : blockEvent,\n        setMessage      : setMessage,\n        addItemDropDown : addItemDropDown,\n        pushToStack     : pushToStack,\n        getContent      : getContent,\n        getUserStyles   : getUserStyles,\n        htmlFromContent : htmlFromContent,\n        generateFinal   : generateFinal,\n        load            : load\n    };\n\n}( jQuery ));\n"],"sourceRoot":"/source/"}