/*!
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed
 * with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
var iframeID="dentifriceIframe",msgPrefix="[Dentifrice]",msgPrefixLen=msgPrefix.length,lang="en",target,dentifrice_postMessage=function(){var e=function(e){function t(){return msgPrefix===(""+n).substr(0,msgPrefixLen)}var n=e.data;n.length>0&&"string"==typeof n&&t()?(logger._debug("Received postmessage :"+n),target.value=n.substr(msgPrefixLen)):logger._debug("Received postmessage, but not for us :"+n)},t=function(){var t=window.addEventListener?"addEventListener":"attachEvent",n=window[t],i="attachEvent"==t?"onmessage":"message";n(i,e,!1)};return{setupMessageListener:t}}(),dentifrice=function(){"use strict";var e={},t={targetId:"dentifrice-textarea",templateUrl:null,stylesUrl:"styles.html",configUrl:"configuration.json",title:"Dentifrice Newsletter",lang:null,log:!0,debug:!1,hideTarget:!0,anchorId:null,replaceAnchor:!1,width:850,height:parseInt(.8*window.outerHeight)},n={en:{"Please validate":"Please validate your edition first !"},fr:{"Please validate":"Veuillez valider l'Ã©diteur !"}},i=function(){var t=navigator.language||navigator.userLanguage;e.lang&&e.lang in n?lang=e.lang:t in n&&(lang=t),logger._debug("Setting locale to: "+lang)},r=function(e){var t=n[lang];return e in t?t[e]:e},o=function(n){for(var i in t)t.hasOwnProperty(i)&&(e[i]=n.hasOwnProperty(i)?n[i]:t[i])},a=function(){var t=document.getElementById(e.targetId);return t&&0!==t.length?(logger._debug("Found element matching selector: "+e.targetId),t):(logger._warn("Could not find element with ID: "+e.targetId),!1)},g=function(){if(null===document.getElementById("dentifriceValidationAlert")){var t=document.getElementById(iframeID),n=document.createElement("div");n.id="dentifriceValidationAlert",n.textContent=r("Please validate"),t.parentNode.insertBefore(n,t);var i=t.getBoundingClientRect(),o=i.top+t.parentNode.scrollTop,a=n.offsetHeight,g=n.offsetWidth,l=parseFloat(o)-parseFloat(a)-4,s=parseFloat(e.width)-parseFloat(g);n.style.cssText="position: relative; top: -10px; left: "+s+"px; opacity: 1;",window.scrollTo(0,l-50),setTimeout(function(){null!==n.parentNode&&n.parentNode.removeChild(n)},2e3)}},l=function(e){logger._info("Initializing settings"),o(e),logger._info("Initializing locale"),i(),logger._info("Getting target element"),target=a(),logger._info("Setting up postMessages listener"),dentifrice_postMessage.setupMessageListener()};return{checkIfValidated:function(){return""===target.value?(g(),!1):!0},settings:e,init_dentifrice:l,bootstrap:function(t){return l(t),e.templateUrl?target?(logger._info("Initializing editor"),_initEditor.init(),!0):(logger._warn("Target element not found, aborting"),!1):(logger._warn("No template URL provided"),!1)}}}(),logger=function(e){var t=function(e,t,n){!0===n&&"object"==typeof window.console&&console[e]("Dentifrice: "+t)};return{_warn:function(e){t("warn",e,!0)},_info:function(n){t("info",n,e.settings.log)},_debug:function(n){t("log",n,e.settings.debug)}}}(dentifrice||{}),_initEditor=function(e){var t=function(){e.settings.hideTarget&&(target.style.display="none");var t=e.settings.templateUrl.replace(/\/[^\/]*$/,"/"),n=/^https?:\/\/|^\/\//i,i=encodeURIComponent(e.settings.templateUrl),r=encodeURIComponent(t+e.settings.stylesUrl);n.test(e.settings.stylesUrl)&&(r=encodeURIComponent(e.settings.stylesUrl));var o=encodeURIComponent(t+e.settings.configUrl);n.test(e.settings.configUrl)&&(o=encodeURIComponent(e.settings.configUrl));var a="",g=document.getElementsByTagName("script"),l=/^(.*)dentifrice\.(min\.)*js$/;[].forEach.call(g,function(e){var t=e.getAttribute("src"),n=l.exec(t);n&&(a=n[1])});var s=a+"editor.html?template="+i+"&styles="+r+"&config="+o+"&lang="+lang+"&title="+e.settings.title,d=document.createElement("iframe");if(d.id=iframeID,d.setAttribute("src",s),d.style.border="0",d.style.width=e.settings.width+"px",d.style.height=e.settings.height+"px",e.settings.anchorId){var c=document.getElementById(e.settings.anchorId);0===c.length?logger._warn("Could not find anchor element with ID: "+e.settings.anchorId):(logger._debug("Found anchor element with ID: "+e.settings.anchorId),e.settings.replaceAnchor?(logger._debug("Replacing anchor element with editor"),c.parentNode.replaceChild(d,c)):(logger._debug("Inserting editor inside anchor element"),c.appendChild(d)))}else target.parentNode.insertBefore(d,target.nextSibling)};return{init:t}}(dentifrice||{});
//# sourceMappingURL=dentifrice.min.js.map
